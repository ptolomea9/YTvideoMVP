{
  "updatedAt": "2026-01-16T07:34:01.415Z",
  "createdAt": "2026-01-13T23:28:53.820Z",
  "id": "Qo2sirL0cDI2fVNQMJ5Eq",
  "name": "Shawheen Youtube Video",
  "description": null,
  "active": true,
  "isArchived": false,
  "nodes": [
    {
      "parameters": {
        "content": "## Generate Video\n",
        "height": 80,
        "width": 320
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        43968,
        15184
      ],
      "typeVersion": 1,
      "id": "aca2c070-b9e1-40de-bac4-1485972163e7",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "c7ce3d37-6455-407a-bf57-286d91c16f97",
              "name": "video_url",
              "value": "={{ $json.movie.url }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        88048,
        29648
      ],
      "id": "71aafb98-7f4c-477b-a0fe-c8a8544bbdb1",
      "name": "Output final video"
    },
    {
      "parameters": {
        "sendTo": "={{ $('Webhook').first().json.body[0].email }}",
        "subject": "Your Property Video is Ready!",
        "message": "=Hi there!\n\nGreat news - your property video has been generated successfully!\n\nYou can view and download your video here:\n{{ $json.movie.url }}\n\nThank you for using our service!\n\nBest regards,\nEdge AI Video Team",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        88272,
        29824
      ],
      "id": "1c55a048-e89b-405d-8436-330d7c59dc20",
      "name": "ðŸŽ‰ Send video URL",
      "webhookId": "a4fb50cc-107d-4525-b37e-94b4abd7f0e3",
      "credentials": {
        "gmailOAuth2": {
          "id": "LgTVoHWwrV9qYrJH",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://y-tvideo-mvp-m2dz.vercel.app/api/videos/complete",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer 0f293a3e6502cda70445cb70b744afbc42356b4feec619ce937f305c15332b77"
            },
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ video_id: $('Webhook').first().json.body[0].videoId, video_url: $json.video_url, status: 'completed', execution_id: $execution.id }) }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        88272,
        29472
      ],
      "id": "1c3cda16-6a4b-49be-9132-ffe8d8ef28cf",
      "name": "HTTP Request"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://backend.edgeairealty.com/api/video/track-execution",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "executionId",
              "value": "={{ $execution.id }}"
            },
            {
              "name": "email",
              "value": "={{ $json.body[0].email }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        77472,
        29504
      ],
      "id": "ff161925-d657-4644-bc9f-08b49368c274",
      "name": "save execution id to db",
      "disabled": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.json2video.com/v2/movies",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "application/json",
        "body": "={\n  \"comment\": \"Final video with captions and end card\",\n  \"resolution\": \"custom\",\n  \"width\": 1080,\n  \"height\": 1920,\n  \"quality\": \"high\",\n  \"scenes\": [\n    {\n      \"comment\": \"Main video scene with captions\",\n      \"duration\": {{ Number($json.video_duration) || 100 }},\n      \"elements\": [\n        {\n          \"type\": \"video\",\n          \"src\": \"{{ $json.video }}\"\n        },\n        {\n          \"type\": \"subtitles\",\n          \"language\": \"\",\n          \"start\": 0,\n          \"style\": \"classic-progressive\",\n          \"position\": \"bottom-center\",\n          \"y\": 1400,\n          \"font-family\": \"Roboto\",\n          \"font-size\": \"60px\",\n          \"font-weight\": \"700\",\n          \"color\": \"#FFFFFF\",\n          \"background-color\": \"rgba(0,0,0,0.6)\"\n        }\n      ]\n    },\n    {\n      \"comment\": \"Closing card - agent branding\",\n      \"duration\": 6,\n      \"background-color\": \"#FFFFFF\",\n      \"elements\": [\n        {\n          \"type\": \"image\",\n          \"src\": \"{{ $json.headshot_url }}\",\n          \"start\": 0.3,\n          \"duration\": 5.7,\n          \"x\": 390,\n          \"y\": 500,\n          \"width\": 300,\n          \"height\": 300,\n          \"style\": \"circle\",\n          \"fade-in\": 0.5\n        },\n        {\n          \"type\": \"text\",\n          \"text\": \"{{ $json.agent_name }}\",\n          \"start\": 0.6,\n          \"duration\": 5.4,\n          \"x\": 0,\n          \"y\": 880,\n          \"width\": 1080,\n          \"settings\": {\n            \"font-family\": \"Roboto\",\n            \"font-size\": \"56px\",\n            \"font-weight\": \"700\",\n            \"color\": \"#1A1A1A\",\n            \"text-align\": \"center\"\n          },\n          \"fade-in\": 0.4\n        },\n        {\n          \"type\": \"text\",\n          \"text\": \"{{ $json.brand_name }}\",\n          \"start\": 0.9,\n          \"duration\": 5.1,\n          \"x\": 0,\n          \"y\": 960,\n          \"width\": 1080,\n          \"settings\": {\n            \"font-family\": \"Roboto\",\n            \"font-size\": \"28px\",\n            \"font-weight\": \"400\",\n            \"color\": \"#666666\",\n            \"text-align\": \"center\"\n          },\n          \"fade-in\": 0.4\n        },\n        {\n          \"type\": \"text\",\n          \"text\": \"{{ $json.phone }}\",\n          \"start\": 1.2,\n          \"duration\": 4.8,\n          \"x\": 0,\n          \"y\": 1100,\n          \"width\": 1080,\n          \"settings\": {\n            \"font-family\": \"Roboto\",\n            \"font-size\": \"32px\",\n            \"font-weight\": \"500\",\n            \"color\": \"#333333\",\n            \"text-align\": \"center\"\n          },\n          \"fade-in\": 0.5\n        },\n        {\n          \"type\": \"text\",\n          \"text\": \"{{ $json.email }}\",\n          \"start\": 1.5,\n          \"duration\": 4.5,\n          \"x\": 0,\n          \"y\": 1160,\n          \"width\": 1080,\n          \"settings\": {\n            \"font-family\": \"Roboto\",\n            \"font-size\": \"24px\",\n            \"font-weight\": \"400\",\n            \"color\": \"#666666\",\n            \"text-align\": \"center\"\n          },\n          \"fade-in\": 0.5\n        }\n      ]\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        87152,
        29648
      ],
      "id": "6662028a-d554-44dc-b420-506a5c0c4372",
      "name": "json2video - Edit video1",
      "credentials": {
        "httpHeaderAuth": {
          "id": "ZmaCE8owCz8ioHlO",
          "name": "json2video"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "2643b070-cbb2-4562-9269-a61389e0c242",
              "leftValue": "={{ $json.movie.status }}",
              "rightValue": "done",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        87824,
        29648
      ],
      "id": "401c7c69-f249-4364-a079-4daedbded16b",
      "name": "Check Errors "
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "var-video",
              "name": "video",
              "value": "={{ $json.movie.url }}",
              "type": "string"
            },
            {
              "id": "var-video-duration",
              "name": "video_duration",
              "value": "={{ $json.movie.duration - 6 }}",
              "type": "number"
            },
            {
              "id": "var-headshot",
              "name": "headshot_url",
              "value": "={{ $('Webhook').first().json.body[0].headshotUrl }}",
              "type": "string"
            },
            {
              "id": "var-agent-name",
              "name": "agent_name",
              "value": "={{ $('Webhook').first().json.body[0].agentName }}",
              "type": "string"
            },
            {
              "id": "var-brand-name",
              "name": "brand_name",
              "value": "={{ $('Webhook').first().json.body[0].brandName || $('Webhook').first().json.body[0].agentName + ' Real Estate' }}",
              "type": "string"
            },
            {
              "id": "var-phone",
              "name": "phone",
              "value": "={{ $('Webhook').first().json.body[0].agentPhone }}",
              "type": "string"
            },
            {
              "id": "var-email",
              "name": "email",
              "value": "={{ $('Webhook').first().json.body[0].agentEmail || $('Webhook').first().json.body[0].email }}",
              "type": "string"
            },
            {
              "id": "var-logo",
              "name": "logo_url",
              "value": "={{ $('Webhook').first().json.body[0].logoUrl }}",
              "type": "string"
            },
            {
              "id": "var-captions",
              "name": "show_captions",
              "value": "={{ $('Webhook').first().json.body[0].showCaptions || 'true' }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        86928,
        29648
      ],
      "id": "98ffa0db-fcad-44f5-88e0-a672372c41e8",
      "name": "Format variables for final editing1"
    },
    {
      "parameters": {
        "amount": 10
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        87376,
        29648
      ],
      "id": "6bfa0b28-ba19-4494-ba31-3eaf1a331674",
      "name": "10 sec1",
      "webhookId": "a26e82ce-7ce3-4c35-8c1b-d38d741e5517"
    },
    {
      "parameters": {
        "amount": 10
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        83792,
        29648
      ],
      "id": "a348d831-6f2a-4a73-86cb-d489c9b48ddc",
      "name": "10 sec3",
      "webhookId": "a785c251-3cad-4a14-8459-982605435a38"
    },
    {
      "parameters": {
        "amount": 1
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        78416,
        29648
      ],
      "id": "e377702b-07f8-407b-96d1-0d536646171a",
      "name": "Wait 30 sec1",
      "webhookId": "77b845bd-e51b-4251-be3f-0a35c9c33b73"
    },
    {
      "parameters": {
        "amount": 30
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        84912,
        29648
      ],
      "id": "6f4111b7-d6fb-43a4-afd2-4ffa133af7ca",
      "name": "30 sec2",
      "webhookId": "80f025e0-e388-4a80-8b4c-1a13950f84c7"
    },
    {
      "parameters": {
        "jsCode": "// Get the images array\nconst images = $input.first().json.body[0].images\n\n// Return each image as a separate item\nreturn images.map(image => ({\n  json: {\n    imageurl: image.imageurl,\n  \n  }\n}));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        77472,
        29792
      ],
      "id": "9ebfc7e0-1c7d-4e8c-b5db-3610540cd1ac",
      "name": "Separate image data"
    },
    {
      "parameters": {
        "url": "=https://api.json2video.com/v2/movies?id={{ $('json2video - Edit video1').item.json.project }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        87600,
        29648
      ],
      "id": "b439fc41-6315-4e23-ab65-62b30d26aaf4",
      "name": "caption generation",
      "credentials": {
        "httpHeaderAuth": {
          "id": "ZmaCE8owCz8ioHlO",
          "name": "json2video"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=https://api.elevenlabs.io/v1/text-to-speech/{{ $('Webhook').first().json.body[0].voiceId }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ text: $json.text, model_id: \"eleven_multilingual_v2\", voice_settings: { stability: 0.5, similarity_boost: 0.75 } }) }}",
        "options": {
          "response": {
            "response": {
              "responseFormat": "file"
            }
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        80208,
        29648
      ],
      "id": "02687d69-da7a-4762-8e11-e651c33c6d5e",
      "name": "Convert text to speech",
      "credentials": {
        "httpHeaderAuth": {
          "id": "rKfEcb8VGDJowZG5",
          "name": "Eleven Labs"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://api.json2video.com/v2/movies?id={{ $('Call jsontovideo to render').item.json.project }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        86480,
        29648
      ],
      "id": "dcd0b02c-2c24-4b81-808d-b6149ac0a249",
      "name": "Get final video status",
      "credentials": {
        "httpHeaderAuth": {
          "id": "ZmaCE8owCz8ioHlO",
          "name": "json2video"
        }
      }
    },
    {
      "parameters": {
        "amount": 30
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        86256,
        29648
      ],
      "id": "507cc1d2-20c2-4883-be96-f557368895c3",
      "name": "30 sec",
      "webhookId": "80f025e0-e388-4a80-8b4c-1a13950f84c7"
    },
    {
      "parameters": {
        "amount": 30
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        81328,
        29648
      ],
      "id": "61e14c86-f6b6-4473-a25d-a6c169db265f",
      "name": "Wait 30 sec3",
      "webhookId": "cecadd7e-cb24-46a8-8889-a7ddedf4e3ff"
    },
    {
      "parameters": {
        "amount": 30
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        82672,
        29648
      ],
      "id": "0725448f-ad1c-4411-b3f0-d27c3497e0ac",
      "name": "30 sec3",
      "webhookId": "0ef02fcf-1b28-452f-8a7f-edbecd24b004"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\nconst grouped = [];\nlet groupIndex = 1;\n\nfor (let i = 0; i < items.length; i += 1) {\n  const groupItems = items.slice(i, i + 1);\n\n  // Parse image URLs\n  const images = groupItems.map(item => {\n    const result = JSON.parse(item.json.data.resultJson);\n    return result.resultUrls[0];\n  });\n\n\n  grouped.push({\n    json: {\n      images: images,\n    }\n  });\n\n  groupIndex++;\n}\n\n// Return grouped items with duration\nreturn grouped;\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        79312,
        29648
      ],
      "id": "870ee445-139a-4ef9-99cd-bf136fb349c6",
      "name": "Make Optimized Images Array from Nano-banana"
    },
    {
      "parameters": {
        "jsCode": "// âœ… Get all items from both nodes\nconst request2Items = $input.all();\nconst request1Items = $items(\"Create task on kie to optimize images\");\n\n// Flatten their JSON data\nconst request2Data = request2Items.map(item => item.json);\nconst request1Data = request1Items.map(item => item.json);\n\n// Check states\nconst hasFailed = request2Data.some(r => r?.data?.state === \"fail\");\nconst allSuccess = request2Data.every(r => r?.data?.state === \"success\");\n\nif (hasFailed) {\n  // âŒ Terminate workflow immediately\n  throw new Error(\"âŒ One or more items have failed. Stopping execution.\");\n}\n\nif (allSuccess) {\n  // âœ… All succeeded â€” append status \"success\"\n  let successData = request2Data.map(item => ({\n    json: {\n      ...item,\n      status: \"success\",\n    },\n  }));\n\n  // ðŸ”¹ Duplicate the first item and add to end\n  const firstItemCopy = {\n    json: {\n      ...successData[0].json\n    }\n  };\n  successData.push(firstItemCopy);\n\n  return successData;\n} else {\n  // â³ Some still running â€” append status \"pending\"\n  return request1Data.map(item => ({\n    json: {\n      ...item,\n      status: \"pending\",\n    },\n  }));\n}\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        78864,
        29648
      ],
      "id": "7645c9ce-1e12-4694-aa27-8150878bf06a",
      "name": "Standerdize Response"
    },
    {
      "parameters": {
        "url": "https://api.kie.ai/api/v1/jobs/recordInfo",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "taskId",
              "value": "={{ $json.data.taskId }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer e46522bee7b4aebb303feeb54eb8e32e"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=9418A560CB6F2F16E797A92ADDCC3F4B"
            },
            {
              "name": "cookie",
              "value": "JSESSIONID=9418A560CB6F2F16E797A92ADDCC3F4B;"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        78640,
        29648
      ],
      "id": "ca118dab-6d76-49c1-8191-408248a36d33",
      "name": "Get image from kie"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.kie.ai/api/v1/jobs/createTask",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer e46522bee7b4aebb303feeb54eb8e32e"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=9418A560CB6F2F16E797A92ADDCC3F4B"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=9418A560CB6F2F16E797A92ADDCC3F4B;"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"google/nano-banana-edit\",\n  \"input\": {\n    \"image_urls\": [\"{{ $json.imageurl }}\"],\n    \"prompt\": \"Take the provided image of any size and convert it to vertical 9:16 aspect ratio (1080Ã—1920).Keep the main subject perfectly centered.Automatically fill extra space (top, bottom, or sides) naturally to make it a full vertical HD image.Preserve all colors, textures, details, and lighting of the original image.Do not crop or distort the main subject.Output should be high definition, clean, and realistic, ready for Reels/TikTok.\",\n    \"output_format\": \"png\",\n    \"image_size\": \"9:16\"\n  }\n} ",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        77744,
        29648
      ],
      "id": "2ad5ad30-5a77-4306-925e-35fa0d962a4f",
      "name": "Create task on kie to optimize images"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "success-condition",
              "leftValue": "={{ $json.status }}",
              "rightValue": "success",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "error-condition",
              "leftValue": "={{ $json.status }}",
              "rightValue": "error",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "failed-condition",
              "leftValue": "={{ $json.status }}",
              "rightValue": "failed",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        79088,
        29648
      ],
      "id": "2c66163b-9d6d-4491-8d5b-2602197bd389",
      "name": "If Status is Success Go Otherwise Wait",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "jsCode": "// Get grouped data\nconst grouped = $input.all().map(item => item.json);\n\n// ---------- PROPERTY INFO ----------\nconst property = $('Webhook').first().json.body[0];\nconst propertyType = property.propertyType;\nconst city = property.city;\nconst price = `$${property.price}`;\nconst BedRoom = property.bedroomCount || '';\nconst RestRoom = property.bathroomCount || '';\nconst mainSellingPoints = property.mainSellingPoints || [];\nconst squareFeet = property.size || '';\nconst lotSize = property.lotSize || '';\nconst preferredTone = property.preferredTone || 'enthusiastic';\n\n// Selling points text\nconst sellingPointsText =\n  mainSellingPoints.length === 1\n    ? mainSellingPoints[0]\n    : mainSellingPoints.length === 2\n    ? `${mainSellingPoints[0]} and ${mainSellingPoints[1]}`\n    : `${mainSellingPoints.slice(0, -1).join(', ')} and ${mainSellingPoints[mainSellingPoints.length - 1]}`;\n\nconst roomCountsText = lotSize\n  ? `${BedRoom} bed, ${RestRoom} bath, ${lotSize} lot size`\n  : `${BedRoom} bed, ${RestRoom} bath`;\n\n// Flatten all images for AI context\nconst allImages = grouped.flatMap(g => g.images);\n\n// Convert images to base64 via API (temp URLs not accessible to OpenAI)\nconst base64Response = await fetch('https://y-tvideo-mvp-m2dz.vercel.app/api/images/to-base64', {\n  method: 'POST',\n  headers: {\n    'Content-Type': 'application/json',\n    'Authorization': 'Bearer 0f293a3e6502cda70445cb70b744afbc42356b4feec619ce937f305c15332b77'\n  },\n  body: JSON.stringify({ urls: allImages })\n});\n\nconst base64Data = await base64Response.json();\nconst base64Images = base64Data.images || [];\n\n// Prepare images for AI analysis using base64\nconst imagesForAI = base64Images.map(img => ({\n  type: \"image_url\",\n  image_url: { url: img.base64 }\n}));\n\n// ---------- USER PROMPT WITH 5 PARTS ----------\nconst userPrompt = `\nWrite a real estate short-form script in a ${preferredTone} tone.\n\nThe property is a ${propertyType} in ${city} priced at ${price}.\nMention ${BedRoom} bedrooms, ${RestRoom} bathrooms, ${squareFeet} sq ft, ${roomCountsText},\nand key features (${sellingPointsText}).\n\nUse image cues naturally (do not say \"look at this\" or \"see that\").\n\nSTRUCTURE & OUTPUT FORMAT (VERY IMPORTANT):\n\nWrite the script as EXACTLY 5 parts â€” NO extra versions, NO alternatives.\n\nPart 1 â€” Intro (include price, city, and property type)\nPart 2 â€” Rooms & specs\nPart 3 â€” Image-based description\nPart 4 â€” Motivation â€” highlight key features and images to excite the client\nPart 5 â€” Outro call-to-action\n\nReturn the final output as:\n\n[Part 1 text]\n\\\\n\\\\n\n[Part 2 text]\n\\\\n\\\\n\n[Part 3 text]\n\\\\n\\\\n\n[Part 4 text]\n\\\\n\\\\n\n[Part 5 text]\n\nDo NOT add headings, labels, numbers, brackets, or bullet points.\nTotal length should remain around 100â€“110 words overall (all parts combined).\nKeep it human, smooth, and friendly.\n`;\n\n// ---------- OPENAI API PAYLOAD ----------\nconst apiPayload = {\n  model: \"gpt-4o\",\n  messages: [\n    {\n      role: \"system\",\n      content: `You are an expert real estate copywriter. Produce only one script and follow the exact formatting rules.`\n    },\n    {\n      role: \"user\",\n      content: [\n        ...imagesForAI,\n        { type: \"text\", text: userPrompt }\n      ]\n    }\n  ],\n  temperature: 0.9\n};\n\nreturn { json: apiPayload };\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        79536,
        29648
      ],
      "id": "1f9548d6-5081-47ea-9e95-fff9628e8fdd",
      "name": "Prepare Body for GPT To Analyze Images",
      "disabled": true
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.openai.com/v1/chat/completions",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "openAiApi",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        79760,
        29648
      ],
      "id": "bfdd831d-ce38-4dff-a826-0e5b2e11f5bb",
      "name": "Call Open AI To Analyze Images And Generate Script Accordingly",
      "credentials": {
        "openAiApi": {
          "id": "t6s7bmAzIhZsEH0A",
          "name": "OpenAi account 2"
        }
      },
      "disabled": true
    },
    {
      "parameters": {
        "jsCode": "// Check if frontend provided script sections (respects user's image order)\nconst webhookResponse = $('Webhook').first().json.body[0].webhookResponse;\n\nif (webhookResponse && webhookResponse.length > 0) {\n  // Use frontend's pre-generated script\n  return webhookResponse.map(text => ({\n    json: { text }\n  }));\n}\n\n// Fallback: use GPT-generated script (legacy path)\nconst content = $input.first().json.choices[0].message.content;\nconst contentArray = content.split('\\n\\n');\nreturn contentArray.map(part => ({\n  json: { text: part }\n}));\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        79984,
        29648
      ],
      "id": "0739a34c-0a42-43a8-881d-1c8a3bdd1370",
      "name": "Split the Script by double newline"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://y-tvideo-mvp-m2dz.vercel.app/api/audio/upload",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "audio/mpeg"
            },
            {
              "name": "Authorization",
              "value": "Bearer 0f293a3e6502cda70445cb70b744afbc42356b4feec619ce937f305c15332b77"
            }
          ]
        },
        "sendBody": true,
        "contentType": "binaryData",
        "inputDataFieldName": "data",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        80432,
        29648
      ],
      "id": "141e090b-e8bb-4c37-95e3-069db7cd3284",
      "name": "Upload Speech To S3"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://y-tvideo-mvp-m2dz.vercel.app/api/audio/duration",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            }
          ]
        },
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ JSON.stringify({ url: $json.Location }) }}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        80656,
        29648
      ],
      "id": "5541fafa-d1a3-4490-a949-46aa3a07d773",
      "name": "Get duration of voices"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.kie.ai/api/v1/jobs/createTask",
        "sendHeaders": true,
        "specifyHeaders": "keypair",
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer e46522bee7b4aebb303feeb54eb8e32e"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=9418A560CB6F2F16E797A92ADDCC3F4B"
            }
          ]
        },
        "sendBody": true,
        "contentType": "json",
        "specifyBody": "json",
        "jsonBody": "={\n  \"model\": \"kling-2.6/image-to-video\",\n  \"input\": {\n    \"image_urls\": [\"{{ $json.imageurl }}\"],\n    \"prompt\": \"{{ $json.prompt }}\",\n    \"negative_prompt\": \"{{ $json.negative_prompt }}\",\n    \"duration\": \"5\",\n    \"sound\": false\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        81104,
        29648
      ],
      "id": "0ef87ce6-24c6-4152-9f75-811da7fd2849",
      "name": "Call Kie Api Kling Model to Generate image to video",
      "credentials": {
        "httpHeaderAuth": {
          "id": "T1nfcHN1C0bAAIpR",
          "name": "Kie.ai"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const images = $('Get image from kie').all();\n\n// Kling prompts optimized for real estate - avoid mirroring/reflection artifacts\nconst prompts = [\n  \"Gentle slow zoom-in, subtle forward camera motion over 5 seconds. Maintain original image integrity with no mirroring, no reflections, no distortion. Keep all edges and boundaries stable. Smooth cinematic quality with natural parallax. Preserve exact colors and lighting.\",\n  \"Very subtle left-to-right drift, barely perceptible slow pan over 5 seconds. No warping, no mirroring, no edge distortion. Maintain image fidelity throughout. Gentle ambient motion with stable framing. Keep original composition intact.\",\n  \"Slow gentle push-in with minimal camera movement over 5 seconds. Preserve image exactly as shown with no transformation or reflection effects. Subtle depth animation only. Clean professional real estate video quality.\"\n];\n\n// Negative prompt to avoid unwanted elements\nconst negativePrompt = \"ceiling fan, spinning fan, rotating blades, mirrored image, reflection, distortion, warping, duplicated elements, reversed image, split screen, kaleidoscope effect, morphing, deformation\";\n\nreturn images.map(image => {\n  const parsed = JSON.parse(image.json.data.resultJson);\n  const resultUrl = parsed.resultUrls[0];\n\n  return {\n    json: {\n      imageurl: resultUrl,\n      prompt: prompts[Math.floor(Math.random() * prompts.length)],\n      negative_prompt: negativePrompt\n    }\n  };\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        80880,
        29648
      ],
      "id": "ca41e087-9f4f-4667-89bb-a33e65fce269",
      "name": "Prepare Body for Kie API (Kling model to generate video)"
    },
    {
      "parameters": {
        "url": "https://api.kie.ai/api/v1/jobs/recordInfo",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "taskId",
              "value": "={{ $json.data.taskId }}"
            }
          ]
        },
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer e46522bee7b4aebb303feeb54eb8e32e"
            },
            {
              "name": "Cookie",
              "value": "JSESSIONID=9418A560CB6F2F16E797A92ADDCC3F4B"
            },
            {
              "name": "cookie",
              "value": "JSESSIONID=9418A560CB6F2F16E797A92ADDCC3F4B;"
            }
          ]
        },
        "options": {
          "redirect": {
            "redirect": {}
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        81552,
        29648
      ],
      "id": "52fa8d7c-ddc7-45b3-ac29-5a372970a57a",
      "name": "Get Kie Video Urls"
    },
    {
      "parameters": {
        "jsCode": "// âœ… Get all items from both nodes\nconst request2Items = $input.all();\nconst request1Items = $items(\"Call Kie Api Kling Model to Generate image to video\");\n\n// Flatten their JSON data\nconst request2Data = request2Items.map(item => item.json);\nconst request1Data = request1Items.map(item => item.json);\n\n// Check states\nconst hasFailed = request2Data.some(r => r?.data?.state === \"failed\");\nconst allSuccess = request2Data.every(r => r?.data?.state === \"success\");\n\nif (hasFailed) {\n  // âŒ Terminate workflow immediately\n  throw new Error(\"âŒ One or more items have failed. Stopping execution.\");\n}\n\nif (allSuccess) {\n  // âœ… All succeeded â€” append status \"success\"\n  return request2Data.map(item => ({\n    json: {\n      ...item,\n      status: \"success\",\n    },\n  }));\n} else {\n  // â³ Some still running â€” append status \"pending\"\n  return request1Data.map(item => ({\n    json: {\n      ...item,\n      status: \"pending\",\n    },\n  }));\n}\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        81776,
        29648
      ],
      "id": "9d6768de-e904-4613-af4d-05adfe528f3b",
      "name": "Standerdized Response"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "success-condition",
              "leftValue": "={{ $json.status }}",
              "rightValue": "success",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "error-condition",
              "leftValue": "={{ $json.status }}",
              "rightValue": "error",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "failed-condition",
              "leftValue": "={{ $json.status }}",
              "rightValue": "failed",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        82000,
        29648
      ],
      "id": "2bc82602-b417-4fc9-ab93-ff2b8ac99717",
      "name": "If Status is Success Go Otherwise Wait1",
      "alwaysOutputData": false
    },
    {
      "parameters": {
        "jsCode": "// Get all Kling video results (flattened)\nconst allItems = $input.all();\n\n// Flatten all URLs into a single array\nconst allUrls = allItems.flatMap(item => {\n  const result = JSON.parse(item.json.data.resultJson);\n  return result.resultUrls || [];\n});\n\n// Define positions (example, repeat if needed)\n\n// Map URLs to JSON output\nreturn allUrls.map((videoUrl, index) => {\n  return {\n    json: {\n      imageVideoUrl: videoUrl\n    }\n  };\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        82224,
        29648
      ],
      "id": "837a7bd0-c5b9-450a-81b9-cbe3a64001f3",
      "name": "Seprate All Video Urls Generatad from Kei"
    },
    {
      "parameters": {
        "url": "=https://api.json2video.com/v2/movies?id={{ $('Render Kie videos in json2video (full duration)').item.json.project }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        82896,
        29648
      ],
      "id": "d4c3bd15-0e85-4740-b0e6-d030a1ea739b",
      "name": "Get Video from Jsontovideo",
      "credentials": {
        "httpHeaderAuth": {
          "id": "ZmaCE8owCz8ioHlO",
          "name": "json2video"
        }
      }
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.json2video.com/v2/movies",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "application/json",
        "body": "={\n  \"resolution\": \"custom\",\n  \"quality\": \"high\",\n  \"width\": 1080,\n  \"height\": 1920,\n  \"scenes\": [\n    {\n      \"elements\": [\n        {\n          \"type\": \"video\",\n          \"src\": \"{{ $json.imageVideoUrl }}\",\n          \"start\": 0,\n          \"width\": 1080,\n          \"height\": 1920\n        }\n      ]\n    }\n  ]\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        82448,
        29648
      ],
      "id": "f5c5c367-aac1-4a95-ba40-024203da1ef4",
      "name": "Render Kie videos in json2video (full duration)",
      "credentials": {
        "httpHeaderAuth": {
          "id": "ZmaCE8owCz8ioHlO",
          "name": "json2video"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "id": "done-condition",
              "leftValue": "={{ $json.movie.status }}",
              "rightValue": "done",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "error-condition",
              "leftValue": "={{ $json.movie.status }}",
              "rightValue": "error",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            }
          ],
          "combinator": "or"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        83120,
        29648
      ],
      "id": "4a3a7b8f-a956-4cab-8cbc-0299a1f220e7",
      "name": "If status is done go otherwise wait"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\n\n// Extract video URLs\nconst videoUrls = items.map(item => item.json.movie.url);\n\n// Build scenes array - simple structure without transitions\nconst scenes = videoUrls.map((url, index) => ({\n  elements: [\n    {\n      type: \"video\",\n      src: url\n    }\n  ]\n}));\n\n// JSON2Video payload\nconst json2videoPayload = {\n  resolution: \"custom\",\n  width: 1080,\n  height: 1920,\n  quality: \"high\",\n  scenes: scenes\n};\n\nreturn [{ json: json2videoPayload }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        83344,
        29648
      ],
      "id": "7c8cadad-9c05-4b18-9c65-8b390860dd7a",
      "name": "Make body for jsontovideo Api to merge videos clips"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.json2video.com/v2/movies",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "scenes",
        "body": "={{ $json}}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        83552,
        29648
      ],
      "id": "7095218c-5573-4f82-8a13-0c938c6ce63a",
      "name": "Call Jsontovideo API to merge clips",
      "credentials": {
        "httpHeaderAuth": {
          "id": "ZmaCE8owCz8ioHlO",
          "name": "json2video"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://api.json2video.com/v2/movies?id={{ $('Call Jsontovideo API to merge clips').item.json.project }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        84016,
        29648
      ],
      "id": "fa34bbc2-2193-4813-903b-3b75836fca46",
      "name": "Get merged video Status",
      "credentials": {
        "httpHeaderAuth": {
          "id": "ZmaCE8owCz8ioHlO",
          "name": "json2video"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "id": "2643b070-cbb2-4562-9269-a61389e0c242",
              "leftValue": "={{ $json.movie.success }}",
              "rightValue": "true",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        84240,
        29648
      ],
      "id": "ff3a6e2f-26ae-49aa-9466-f3bc7b811308",
      "name": "If status is done go otherwise wait1"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================\n// prepare body for jsontovideo to set video\n// Adds narration audio to merged video clips\n// FIXED: Uses sectionImageMapping for sync - audio plays when its images appear\n// ============================================================\n\nconst movieData = $input.first().json.movie;\n\n// VALIDATION: Ensure we have valid movie data\nif (!movieData) {\n  throw new Error('PIPELINE ERROR: No movie data from merged video.');\n}\nif (!movieData.url) {\n  throw new Error('PIPELINE ERROR: movie.url is undefined. Merged video may have failed. Status: ' + (movieData.status || 'unknown'));\n}\nif (movieData.duration === undefined || movieData.duration === null) {\n  throw new Error('PIPELINE ERROR: movie.duration is undefined. Cannot calculate narration timing.');\n}\n\nconst videoUrl = movieData.url;\nconst videoDuration = Number(movieData.duration);\n\n// VALIDATION: Ensure videoDuration is a valid positive number\nif (isNaN(videoDuration) || videoDuration <= 0) {\n  throw new Error('PIPELINE ERROR: Invalid videoDuration: ' + movieData.duration + '. Must be a positive number.');\n}\n\n// Get audio items\nconst audioItems = $('Get duration of voices').all();\n\nif (!audioItems || audioItems.length === 0) {\n  throw new Error('PIPELINE ERROR: No audio items from Get duration of voices.');\n}\n\nconst audioClips = audioItems.map((a, idx) => {\n  const url = a.json.data?.url;\n  const duration = Number(a.json.data?.duration);\n  if (!url) {\n    throw new Error(`PIPELINE ERROR: Audio clip ${idx} has no URL.`);\n  }\n  if (isNaN(duration) || duration <= 0) {\n    throw new Error(`PIPELINE ERROR: Audio clip ${idx} has invalid duration: ${a.json.data?.duration}`);\n  }\n  return { url, duration };\n});\n\n// ----------------------\n// SECTION-AWARE TIMING\n// ----------------------\nconst CLIP_DURATION = 5; // Each Kling clip = 5 seconds\n\n// Get section-to-image mapping from webhook\nconst webhookData = $('Webhook').first().json.body;\nlet sectionMapping = [];\n\n// Handle both array and single object formats\nif (Array.isArray(webhookData) && webhookData[0]?.sectionImageMapping) {\n  sectionMapping = webhookData[0].sectionImageMapping;\n} else if (webhookData?.sectionImageMapping) {\n  sectionMapping = webhookData.sectionImageMapping;\n}\n\nconsole.log('Section mapping from webhook:', JSON.stringify(sectionMapping, null, 2));\nconsole.log('Audio clips count:', audioClips.length);\nconsole.log('Video duration:', videoDuration, 's');\n\nlet timeline = [];\n\nif (sectionMapping && sectionMapping.length > 0) {\n  // CASE 1: Use section mapping for sync\n  console.log('Strategy: Section-aware timing - audio syncs with image appearance');\n  \n  // Section order from frontend: [opening, outdoor, living, private, closing]\n  // But sectionMapping may have different order based on image assignments\n  \n  for (let i = 0; i < audioClips.length; i++) {\n    const section = sectionMapping[i];\n    const clip = audioClips[i];\n    \n    if (!section || !section.imageIndices || section.imageIndices.length === 0) {\n      // If no section mapping, place after previous clip\n      const lastEnd = timeline.length > 0 \n        ? timeline[timeline.length - 1].start + audioClips[i - 1].duration \n        : 0;\n      console.log(`Section ${i} (${section?.section || 'unknown'}): No image mapping, placing at ${lastEnd}s`);\n      timeline.push({\n        type: 'audio',\n        src: clip.url,\n        start: parseFloat(lastEnd.toFixed(3)),\n        loop: 0,\n        volume: 2\n      });\n      continue;\n    }\n    \n    // Find earliest image in this section\n    const firstImageIndex = Math.min(...section.imageIndices);\n    \n    // Narration starts when its first image appears\n    // Special handling for 'closing' section - place at end of video\n    let sectionStart;\n    if (section.section === 'closing') {\n      // Closing should start near end, leaving room for narration\n      sectionStart = Math.max(videoDuration - clip.duration - 1, 0);\n      console.log(`Section ${i} (closing): Placing at end, start=${sectionStart}s`);\n    } else {\n      sectionStart = firstImageIndex * CLIP_DURATION;\n      console.log(`Section ${i} (${section.section}): First image=${firstImageIndex}, start=${sectionStart}s`);\n    }\n    \n    timeline.push({\n      type: 'audio',\n      src: clip.url,\n      start: parseFloat(Math.max(0, sectionStart).toFixed(3)),\n      loop: 0,\n      volume: 2\n    });\n  }\n  \n  // Sort by start time to avoid any overlap issues\n  timeline.sort((a, b) => a.start - b.start);\n  \n} else {\n  // CASE 2: Fallback - no section mapping, use sequential placement\n  console.log('Strategy: No section mapping - falling back to sequential');\n  \n  const introSilence = 2; // Short intro silence\n  let t = introSilence;\n  \n  audioClips.forEach((clip, idx) => {\n    console.log(`Audio ${idx}: start=${t}s, duration=${clip.duration}s`);\n    timeline.push({\n      type: 'audio',\n      src: clip.url,\n      start: parseFloat(t.toFixed(3)),\n      loop: 0,\n      volume: 2\n    });\n    t += clip.duration + 0.5; // Small gap between clips\n  });\n}\n\n// Log final timeline\nconsole.log('Final audio timeline:');\ntimeline.forEach((t, i) => {\n  console.log(`  [${i}] start: ${t.start}s`);\n});\n\n// ----------------------\n// JSON2Video payload\n// ----------------------\nconst payload = {\n  width: 1080,\n  height: 1920,\n  quality: 'high',\n  resolution: 'custom',\n  scenes: [\n    {\n      elements: [\n        {\n          type: 'video',\n          src: videoUrl,\n          volume: 0 // Mute merged clips (they have no audio anyway)\n        },\n        ...timeline\n      ]\n    }\n  ]\n};\n\nconsole.log('Payload prepared with', timeline.length, 'audio clips');\nconsole.log('First audio starts at:', timeline[0]?.start, 's');\nconsole.log('Last audio starts at:', timeline[timeline.length - 1]?.start, 's');\n\nreturn [{ json: payload }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        84464,
        29648
      ],
      "id": "cae2002a-6959-4678-92f2-f4c379fc3425",
      "name": "prepare body for jsontovideo to set video"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.json2video.com/v2/movies",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "scenes",
        "body": "={{ $json}}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        84688,
        29648
      ],
      "id": "066479f5-4324-4bc4-8321-e5853e007784",
      "name": "Call Jsontovideo to create task",
      "credentials": {
        "httpHeaderAuth": {
          "id": "ZmaCE8owCz8ioHlO",
          "name": "json2video"
        }
      }
    },
    {
      "parameters": {
        "url": "=https://api.json2video.com/v2/movies?id={{ $('Call Jsontovideo to create task').item.json.project }}",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        85136,
        29648
      ],
      "id": "afd367fd-42bb-452f-9ac9-31ce4d75af0c",
      "name": "Get video status",
      "credentials": {
        "httpHeaderAuth": {
          "id": "ZmaCE8owCz8ioHlO",
          "name": "json2video"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "id": "cond1-success-true",
              "leftValue": "={{ $json.movie.success }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        85360,
        29648
      ],
      "id": "3a550f1e-d2ed-47ee-a352-65644d88b380",
      "name": "If Task is Status is done go otherwise wait"
    },
    {
      "parameters": {
        "jsCode": "// Validate input from previous render step\nconst movieData = $input.first().json.movie;\nif (!movieData) {\n  throw new Error('PIPELINE ERROR: No movie data from previous render. Check \"Get video status\" output.');\n}\nif (!movieData.url) {\n  throw new Error('PIPELINE ERROR: movie.url is undefined. Previous render (\"Call Jsontovideo to create task\") may have failed. Status: ' + (movieData.status || 'unknown') + ', Error: ' + (movieData.message || 'none'));\n}\nif (!movieData.duration) {\n  throw new Error('PIPELINE ERROR: movie.duration is undefined.');\n}\n\nconst videoUrl = movieData.url;\nconst videoDuration = Number(movieData.duration);\nconst musicUrl = $('Webhook').first().json.body[0].music;\n\nconst audioDetails = $('Get duration of voices').all();\nconst audioStarting = $('prepare body for jsontovideo to set video').all();\n\n// Validate audio data\nif (!audioDetails || audioDetails.length === 0) {\n  throw new Error('PIPELINE ERROR: No audio details from \"Get duration of voices\"');\n}\nif (!audioStarting || audioStarting.length === 0 || !audioStarting[0].json.scenes) {\n  throw new Error('PIPELINE ERROR: No audio starting times from \"prepare body for jsontovideo to set video\"');\n}\n\n// durations from API\nconst durations = audioDetails.map(item => {\n  const dur = item.json.data?.duration;\n  if (dur === undefined) {\n    throw new Error('PIPELINE ERROR: Audio item missing duration');\n  }\n  return dur;\n});\n\n// extract start times from scenes\nconst starts = audioStarting[0].json.scenes[0].elements\n  .filter(el => el.type === 'audio')\n  .map(el => el.start);\n\nreturn [\n  {\n    json: {\n      videoUrl,\n      musicUrl,\n      durations,\n      starts,\n      videoDuration\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        85584,
        29648
      ],
      "id": "2b131b50-6524-4e9f-877c-732f1ba94016",
      "name": "get video metadata to add music"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.json2video.com/v2/movies",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "contentType": "raw",
        "rawContentType": "scenes",
        "body": "={{ $json}}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        86032,
        29648
      ],
      "id": "bb155957-fa48-4f53-a614-120cc5ebb80f",
      "name": "Call jsontovideo to render",
      "credentials": {
        "httpHeaderAuth": {
          "id": "ZmaCE8owCz8ioHlO",
          "name": "json2video"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "version": 2,
            "leftValue": "",
            "caseSensitive": true,
            "typeValidation": "loose"
          },
          "conditions": [
            {
              "id": "cond1-success-true",
              "leftValue": "={{ $json.movie.success }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equals"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        86704,
        29648
      ],
      "id": "ce04738d-8506-4d61-b84d-173e4cf8c121",
      "name": "if task is done go otherwise wait"
    },
    {
      "parameters": {
        "jsCode": "// ============================================================\n// Prepare body for jsontovideo to render video\n// Adds ONLY music track with ducking - no text overlays\n// Video volume = 1 to preserve narration from previous render\n// ============================================================\n\nconst inputData = $input.first().json;\n\n// VALIDATION\nif (!inputData.videoUrl) {\n  throw new Error('VIDEO_URL_MISSING: videoUrl is undefined.');\n}\nif (!inputData.videoDuration || isNaN(inputData.videoDuration)) {\n  throw new Error('VIDEO_DURATION_MISSING: videoDuration is ' + inputData.videoDuration);\n}\nif (!inputData.musicUrl) {\n  throw new Error('MUSIC_URL_MISSING: musicUrl is undefined.');\n}\nif (!inputData.durations || !inputData.starts) {\n  throw new Error('AUDIO_DATA_MISSING: durations or starts array is undefined.');\n}\n\nconst videoUrl = inputData.videoUrl;\nconst musicUrl = inputData.musicUrl;\nconst durations = inputData.durations;\nconst starts = inputData.starts;\nconst videoDuration = Number(inputData.videoDuration);\n\n// Music volume settings\nconst MUSIC_HIGH = 0.8;\nconst MUSIC_LOW = 0.15;\nconst FADE_TIME = 0.5;\nconst MUSIC_TRACK_DURATION = 90;\n\nlet musicTimeline = [];\nlet currentTime = 0;\nlet musicOffset = 0;\n\n// Build music timeline with ducking during voice segments\nfor (let i = 0; i < starts.length; i++) {\n  const voiceStart = starts[i];\n  const voiceDuration = durations[i];\n  const voiceEnd = voiceStart + voiceDuration;\n\n  // High-volume music during gaps (before voice)\n  if (voiceStart > currentTime) {\n    const gapDuration = voiceStart - currentTime;\n    musicTimeline.push({\n      type: 'audio',\n      src: musicUrl,\n      start: currentTime,\n      seek: musicOffset % MUSIC_TRACK_DURATION,\n      duration: gapDuration,\n      volume: MUSIC_HIGH,\n      'fade-out': FADE_TIME\n    });\n    musicOffset += gapDuration;\n  }\n\n  // Low-volume music during voice (ducked)\n  musicTimeline.push({\n    type: 'audio',\n    src: musicUrl,\n    start: voiceStart,\n    seek: musicOffset % MUSIC_TRACK_DURATION,\n    duration: voiceDuration,\n    volume: MUSIC_LOW,\n    'fade-in': FADE_TIME,\n    'fade-out': FADE_TIME\n  });\n  musicOffset += voiceDuration;\n  currentTime = voiceEnd;\n}\n\n// Remaining music after last voice\nif (currentTime < videoDuration) {\n  const remainingDuration = videoDuration - currentTime;\n  musicTimeline.push({\n    type: 'audio',\n    src: musicUrl,\n    start: currentTime,\n    seek: musicOffset % MUSIC_TRACK_DURATION,\n    duration: remainingDuration,\n    volume: MUSIC_HIGH,\n    'fade-in': FADE_TIME,\n    'fade-out': 1.0\n  });\n}\n\n// Build final json2video payload\n// NOTE: video volume = 1 to PRESERVE NARRATION from previous render!\nconst payload = {\n  width: 1080,\n  height: 1920,\n  quality: 'high',\n  resolution: 'custom',\n  scenes: [\n    {\n      elements: [\n        {\n          type: 'video',\n          src: videoUrl,\n          volume: 1  // IMPORTANT: Keep narration audio!\n        },\n        ...musicTimeline\n      ]\n    }\n  ]\n};\n\nreturn [{ json: payload }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        85808,
        29648
      ],
      "id": "3b77d61f-9dda-4d96-aeab-8f9bdf2eade1",
      "name": "Prepare body for jsontovideo to render video"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "db085427-02a1-4f47-9934-9c258aa929b3",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2.1,
      "position": [
        77152,
        29760
      ],
      "id": "161e7300-d90f-43fc-94dc-457cd14e976a",
      "name": "Webhook",
      "webhookId": "db085427-02a1-4f47-9934-9c258aa929b3"
    }
  ],
  "connections": {
    "Output final video": {
      "main": [
        [
          {
            "node": "ðŸŽ‰ Send video URL",
            "type": "main",
            "index": 0
          },
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "json2video - Edit video1": {
      "main": [
        [
          {
            "node": "10 sec1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Check Errors ": {
      "main": [
        [
          {
            "node": "Output final video",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "10 sec1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format variables for final editing1": {
      "main": [
        [
          {
            "node": "json2video - Edit video1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "10 sec1": {
      "main": [
        [
          {
            "node": "caption generation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "10 sec3": {
      "main": [
        [
          {
            "node": "Get merged video Status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait 30 sec1": {
      "main": [
        [
          {
            "node": "Get image from kie",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "30 sec2": {
      "main": [
        [
          {
            "node": "Get video status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Separate image data": {
      "main": [
        [
          {
            "node": "Create task on kie to optimize images",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "caption generation": {
      "main": [
        [
          {
            "node": "Check Errors ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Convert text to speech": {
      "main": [
        [
          {
            "node": "Upload Speech To S3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get final video status": {
      "main": [
        [
          {
            "node": "if task is done go otherwise wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "30 sec": {
      "main": [
        [
          {
            "node": "Get final video status",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Wait 30 sec3": {
      "main": [
        [
          {
            "node": "Get Kie Video Urls",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "30 sec3": {
      "main": [
        [
          {
            "node": "Get Video from Jsontovideo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Make Optimized Images Array from Nano-banana": {
      "0": [
        [
          {
            "node": "Split the Script by double newline",
            "type": "0",
            "index": 0
          }
        ]
      ],
      "main": [
        [
          {
            "node": "Prepare Body for GPT To Analyze Images",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Standerdize Response": {
      "main": [
        [
          {
            "node": "If Status is Success Go Otherwise Wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get image from kie": {
      "main": [
        [
          {
            "node": "Standerdize Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create task on kie to optimize images": {
      "main": [
        [
          {
            "node": "Wait 30 sec1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Status is Success Go Otherwise Wait": {
      "main": [
        [
          {
            "node": "Make Optimized Images Array from Nano-banana",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait 30 sec1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Body for GPT To Analyze Images": {
      "main": [
        [
          {
            "node": "Call Open AI To Analyze Images And Generate Script Accordingly",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call Open AI To Analyze Images And Generate Script Accordingly": {
      "main": [
        [
          {
            "node": "Split the Script by double newline",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split the Script by double newline": {
      "main": [
        [
          {
            "node": "Convert text to speech",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Upload Speech To S3": {
      "main": [
        [
          {
            "node": "Get duration of voices",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call Kie Api Kling Model to Generate image to video": {
      "main": [
        [
          {
            "node": "Wait 30 sec3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Body for Kie API (Kling model to generate video)": {
      "main": [
        [
          {
            "node": "Call Kie Api Kling Model to Generate image to video",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Kie Video Urls": {
      "main": [
        [
          {
            "node": "Standerdized Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Standerdized Response": {
      "main": [
        [
          {
            "node": "If Status is Success Go Otherwise Wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Status is Success Go Otherwise Wait1": {
      "main": [
        [
          {
            "node": "Seprate All Video Urls Generatad from Kei",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Wait 30 sec3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Video from Jsontovideo": {
      "main": [
        [
          {
            "node": "If status is done go otherwise wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Render Kie videos in json2video (full duration)": {
      "main": [
        [
          {
            "node": "30 sec3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If status is done go otherwise wait": {
      "main": [
        [
          {
            "node": "Make body for jsontovideo Api to merge videos clips",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "30 sec3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Make body for jsontovideo Api to merge videos clips": {
      "main": [
        [
          {
            "node": "Call Jsontovideo API to merge clips",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call Jsontovideo API to merge clips": {
      "main": [
        [
          {
            "node": "10 sec3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get merged video Status": {
      "main": [
        [
          {
            "node": "If status is done go otherwise wait1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If status is done go otherwise wait1": {
      "main": [
        [
          {
            "node": "prepare body for jsontovideo to set video",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "10 sec3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "prepare body for jsontovideo to set video": {
      "main": [
        [
          {
            "node": "Call Jsontovideo to create task",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call Jsontovideo to create task": {
      "main": [
        [
          {
            "node": "30 sec2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get video status": {
      "main": [
        [
          {
            "node": "If Task is Status is done go otherwise wait",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If Task is Status is done go otherwise wait": {
      "main": [
        [
          {
            "node": "get video metadata to add music",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "30 sec2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "get video metadata to add music": {
      "main": [
        [
          {
            "node": "Prepare body for jsontovideo to render video",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Call jsontovideo to render": {
      "main": [
        [
          {
            "node": "30 sec",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "if task is done go otherwise wait": {
      "main": [
        [
          {
            "node": "Format variables for final editing1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "30 sec",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Prepare body for jsontovideo to render video": {
      "main": [
        [
          {
            "node": "Call jsontovideo to render",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook": {
      "main": [
        [
          {
            "node": "Separate image data",
            "type": "main",
            "index": 0
          },
          {
            "node": "save execution id to db",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get duration of voices": {
      "main": [
        [
          {
            "node": "Prepare Body for Kie API (Kling model to generate video)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Seprate All Video Urls Generatad from Kei": {
      "main": [
        [
          {
            "node": "Render Kie videos in json2video (full duration)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "settings": {
    "executionOrder": "v1",
    "availableInMCP": false,
    "callerPolicy": "workflowsFromSameOwner"
  },
  "staticData": null,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "pinData": {
    "Webhook": [
      {
        "json": {
          "headers": {
            "host": "edgeaimedia.app.n8n.cloud",
            "user-agent": "node",
            "content-length": "18997",
            "accept": "*/*",
            "accept-encoding": "gzip, br",
            "accept-language": "*",
            "cdn-loop": "cloudflare; loops=1; subreqs=1",
            "cf-connecting-ip": "54.173.137.15",
            "cf-ew-via": "15",
            "cf-ipcountry": "US",
            "cf-ray": "9be50bf096c48024-IAD",
            "cf-visitor": "{\"scheme\":\"https\"}",
            "cf-worker": "n8n.cloud",
            "content-type": "application/json",
            "sec-fetch-mode": "cors",
            "x-forwarded-for": "54.173.137.15, 172.68.15.150",
            "x-forwarded-host": "edgeaimedia.app.n8n.cloud",
            "x-forwarded-port": "443",
            "x-forwarded-proto": "https",
            "x-forwarded-server": "traefik-prod-users-gwc-1-7b58f7489d-m5cpm",
            "x-is-trusted": "yes",
            "x-real-ip": "54.173.137.15",
            "x-vercel-id": "sfo1::8457g-1768476683516-ed8e5cb798db"
          },
          "params": {},
          "query": {},
          "body": [
            {
              "images": [
                {
                  "imageurl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/d7f5b65e-27ba-45f9-87cf-37495ce34917/XHtQ5nsDn2e8gvyVKcYM2.webp"
                },
                {
                  "imageurl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/d7f5b65e-27ba-45f9-87cf-37495ce34917/FyIs0TypkDsJON4ihUVda.webp"
                },
                {
                  "imageurl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/d7f5b65e-27ba-45f9-87cf-37495ce34917/sipQBdjd5iOAqilH64YMe.webp"
                },
                {
                  "imageurl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/d7f5b65e-27ba-45f9-87cf-37495ce34917/jnWRh6lNiuFvhFfCFrMbL.webp"
                },
                {
                  "imageurl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/d7f5b65e-27ba-45f9-87cf-37495ce34917/_jKIr9q8bnYUcVZx6Gavn.webp"
                },
                {
                  "imageurl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/d7f5b65e-27ba-45f9-87cf-37495ce34917/GAnOS0c1-xVJT0S9b0OdD.webp"
                },
                {
                  "imageurl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/d7f5b65e-27ba-45f9-87cf-37495ce34917/5c6Ev6gu0hW6pFxXHRy7k.webp"
                },
                {
                  "imageurl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/d7f5b65e-27ba-45f9-87cf-37495ce34917/TEHqY4eS2FfHpOlrds_EF.webp"
                },
                {
                  "imageurl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/d7f5b65e-27ba-45f9-87cf-37495ce34917/mO6XlZhYPgygsiOJjonbE.webp"
                },
                {
                  "imageurl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/d7f5b65e-27ba-45f9-87cf-37495ce34917/zbLxs56w3IGDZ2M_ov_mU.webp"
                },
                {
                  "imageurl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/d7f5b65e-27ba-45f9-87cf-37495ce34917/x-rZR7IOLeC69WXImZ6dR.webp"
                }
              ],
              "imageTiming": [
                {
                  "imageurl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/d7f5b65e-27ba-45f9-87cf-37495ce34917/XHtQ5nsDn2e8gvyVKcYM2.webp",
                  "start": 0,
                  "duration": 0.04,
                  "fadeIn": 0,
                  "fadeOut": 0.2
                },
                {
                  "imageurl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/d7f5b65e-27ba-45f9-87cf-37495ce34917/FyIs0TypkDsJON4ihUVda.webp",
                  "start": 0.04,
                  "duration": 13.24,
                  "fadeIn": 0.2,
                  "fadeOut": 0.2
                },
                {
                  "imageurl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/d7f5b65e-27ba-45f9-87cf-37495ce34917/sipQBdjd5iOAqilH64YMe.webp",
                  "start": 13.27,
                  "duration": 13.12,
                  "fadeIn": 0.2,
                  "fadeOut": 0.2
                },
                {
                  "imageurl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/d7f5b65e-27ba-45f9-87cf-37495ce34917/jnWRh6lNiuFvhFfCFrMbL.webp",
                  "start": 26.39,
                  "duration": 13.06,
                  "fadeIn": 0.2,
                  "fadeOut": 0.2
                },
                {
                  "imageurl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/d7f5b65e-27ba-45f9-87cf-37495ce34917/_jKIr9q8bnYUcVZx6Gavn.webp",
                  "start": 39.45,
                  "duration": 15.1,
                  "fadeIn": 0.2,
                  "fadeOut": 0.2
                },
                {
                  "imageurl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/d7f5b65e-27ba-45f9-87cf-37495ce34917/GAnOS0c1-xVJT0S9b0OdD.webp",
                  "start": 54.56,
                  "duration": 13.09,
                  "fadeIn": 0.2,
                  "fadeOut": 0.2
                },
                {
                  "imageurl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/d7f5b65e-27ba-45f9-87cf-37495ce34917/5c6Ev6gu0hW6pFxXHRy7k.webp",
                  "start": 67.64,
                  "duration": 13.28,
                  "fadeIn": 0.2,
                  "fadeOut": 0.2
                },
                {
                  "imageurl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/d7f5b65e-27ba-45f9-87cf-37495ce34917/TEHqY4eS2FfHpOlrds_EF.webp",
                  "start": 80.92,
                  "duration": 14.8,
                  "fadeIn": 0.2,
                  "fadeOut": 0.2
                },
                {
                  "imageurl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/d7f5b65e-27ba-45f9-87cf-37495ce34917/mO6XlZhYPgygsiOJjonbE.webp",
                  "start": 95.72,
                  "duration": 12.98,
                  "fadeIn": 0.2,
                  "fadeOut": 0.2
                },
                {
                  "imageurl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/d7f5b65e-27ba-45f9-87cf-37495ce34917/zbLxs56w3IGDZ2M_ov_mU.webp",
                  "start": 108.7,
                  "duration": 13.38,
                  "fadeIn": 0.2,
                  "fadeOut": 0.2
                },
                {
                  "imageurl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/d7f5b65e-27ba-45f9-87cf-37495ce34917/x-rZR7IOLeC69WXImZ6dR.webp",
                  "start": 122.08,
                  "duration": 21.92,
                  "fadeIn": 0.2,
                  "fadeOut": 0
                }
              ],
              "email": "shawheendn@gmail.com",
              "title": "123 Luxury Lane, Beverly Hills",
              "social_handles": "@luxuryhomes",
              "music": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/music/tracks/gentle-pulses-light-prism-main-version-43032-02-24.mp3",
              "musicBpm": 110,
              "musicBeats": [
                0.035,
                0.313,
                0.441,
                0.557,
                0.731,
                0.987,
                1.242,
                1.393,
                1.637,
                1.811,
                2.067,
                2.357,
                2.612,
                2.902,
                3.019,
                3.181,
                3.425,
                3.82,
                4.029,
                4.365,
                4.528,
                4.679,
                4.818,
                4.923,
                5.097,
                5.352,
                5.608,
                6.002,
                6.177,
                6.42,
                6.56,
                6.734,
                6.978,
                7.268,
                7.372,
                7.546,
                7.79,
                8.081,
                8.185,
                8.464,
                8.731,
                8.905,
                9.16,
                9.439,
                9.567,
                9.729,
                9.985,
                10.368,
                10.797,
                11.204,
                11.355,
                11.459,
                11.622,
                11.738,
                11.935,
                12.156,
                12.446,
                12.562,
                12.725,
                12.98,
                13.096,
                13.27,
                13.526,
                13.816,
                13.92,
                14.083,
                14.187,
                14.35,
                14.733,
                14.93,
                15.163,
                15.72,
                15.999,
                16.103,
                16.405,
                16.544,
                16.649,
                16.916,
                17.183,
                17.357,
                17.891,
                18.158,
                18.448,
                18.553,
                18.704,
                18.855,
                19.087,
                19.296,
                19.54,
                19.644,
                19.9,
                20.085,
                20.19,
                20.352,
                20.631,
                20.886,
                21.177,
                21.455,
                21.711,
                21.954,
                22.245,
                22.547,
                22.814,
                22.918,
                23.069,
                23.452,
                23.638,
                23.893,
                24.137,
                24.288,
                24.451,
                24.555,
                24.718,
                25.02,
                25.252,
                25.53,
                25.774,
                25.925,
                26.088,
                26.192,
                26.389,
                26.622,
                26.889,
                27.167,
                27.283,
                27.434,
                27.725,
                28.015,
                28.247,
                28.584,
                28.804,
                29.071,
                29.385,
                29.617,
                29.907,
                30.221,
                30.43,
                30.546,
                30.72,
                30.975,
                31.231,
                31.382,
                31.533,
                31.649,
                31.8,
                32.183,
                32.369,
                32.612,
                32.868,
                33.17,
                33.448,
                33.553,
                33.727,
                33.982,
                34.215,
                34.366,
                34.54,
                34.807,
                35.039,
                35.352,
                35.619,
                35.898,
                36.165,
                36.444,
                36.548,
                36.711,
                36.827,
                36.989,
                37.222,
                37.535,
                37.767,
                37.93,
                38.069,
                38.348,
                38.638,
                38.87,
                39.033,
                39.277,
                39.451,
                39.706,
                39.95,
                40.101,
                40.275,
                40.519,
                40.67,
                40.914,
                41.355,
                41.61,
                41.749,
                41.9,
                42.017,
                42.167,
                42.446,
                42.551,
                42.701,
                42.992,
                43.224,
                43.363,
                43.526,
                43.804,
                44.083,
                44.35,
                44.629,
                44.733,
                44.884,
                45.267,
                45.43,
                45.825,
                46.022,
                46.126,
                46.254,
                46.382,
                46.533,
                46.846,
                47.067,
                47.311,
                47.462,
                47.613,
                47.763,
                47.996,
                48.158,
                48.321,
                48.448,
                48.553,
                48.715,
                48.994,
                49.099,
                49.25,
                49.459,
                49.633,
                49.83,
                50.074,
                50.318,
                50.492,
                50.631,
                50.736,
                50.887,
                51.177,
                51.281,
                51.432,
                51.699,
                51.827,
                51.978,
                52.106,
                52.233,
                52.547,
                52.814,
                53.081,
                53.371,
                53.534,
                53.731,
                53.998,
                54.393,
                54.555,
                54.834,
                54.996,
                55.217,
                55.38,
                55.577,
                55.809,
                55.96,
                56.088,
                56.192,
                56.483,
                56.738,
                56.9,
                57.168,
                57.562,
                57.841,
                57.992,
                58.143,
                58.375,
                58.921,
                59.095,
                59.35,
                59.524,
                59.733,
                59.942,
                60.175,
                60.407,
                60.558,
                60.836,
                61.092,
                61.324,
                61.533,
                61.893,
                62.09,
                62.357,
                62.729,
                62.903,
                63.286,
                63.716,
                64.099,
                64.284,
                64.551,
                64.819,
                64.923,
                65.26,
                65.469,
                65.898,
                66.281,
                66.467,
                66.572,
                66.723,
                66.92,
                67.094,
                67.442,
                67.64,
                67.884,
                68.081,
                68.197,
                68.464,
                68.661,
                68.894,
                69.137,
                69.567,
                69.822,
                69.985,
                70.194,
                70.38,
                70.531,
                70.658,
                70.925,
                71.088,
                71.285,
                71.471,
                71.645,
                71.924,
                72.156,
                72.295,
                72.469,
                72.829,
                73.108,
                73.271,
                73.468,
                73.642,
                74.025,
                74.188,
                74.374,
                74.641,
                74.745,
                74.908,
                75.291,
                75.465,
                75.836,
                76.115,
                76.37,
                76.684,
                76.928,
                77.09,
                77.195,
                77.462,
                77.648,
                77.752,
                77.915,
                78.019,
                78.53,
                78.878,
                78.994,
                79.099,
                79.273,
                79.435,
                79.644,
                79.819,
                80.19,
                80.364,
                80.631,
                80.747,
                80.922,
                81.177,
                81.293,
                81.456,
                81.572,
                81.734,
                82.001,
                82.268,
                82.373,
                82.547,
                82.709,
                82.814,
                82.918,
                83.197,
                83.36,
                83.592,
                83.754,
                83.905,
                84.114,
                84.451,
                84.567,
                84.73,
                84.997,
                85.101,
                85.252,
                85.519,
                85.775,
                85.925,
                86.053,
                86.204,
                86.46,
                86.634,
                86.901,
                87.11,
                87.284,
                87.458,
                87.713,
                87.98,
                88.259,
                88.514,
                88.909,
                89.199,
                89.35,
                89.583,
                89.803,
                89.908,
                90.012,
                90.175,
                90.442,
                90.709,
                90.999,
                91.231,
                91.521,
                91.777,
                92.09,
                92.323,
                92.473,
                92.729,
                92.891,
                93.275,
                93.425,
                93.716,
                93.96,
                94.273,
                94.528,
                94.912,
                95.062,
                95.364,
                95.724,
                95.898,
                96.131,
                96.444,
                96.723,
                96.885,
                96.99,
                97.106,
                97.257,
                97.64,
                97.802,
                98.081,
                98.313,
                98.627,
                98.859,
                99.01,
                99.277,
                99.439,
                99.718,
                99.985,
                100.264,
                100.519,
                100.798,
                101.053,
                101.204,
                101.46,
                101.611,
                102.005,
                102.156,
                102.446,
                102.679,
                102.992,
                103.259,
                103.642,
                103.805,
                104.06,
                104.316,
                104.478,
                104.629,
                104.966,
                105.175,
                105.442,
                105.709,
                105.976,
                106.371,
                106.649,
                106.8,
                106.916,
                107.032,
                107.357,
                107.601,
                107.892,
                108.17,
                108.449,
                108.704,
                108.983,
                109.238,
                109.54,
                109.784,
                110.19,
                110.341,
                110.736,
                110.887,
                111.166,
                111.409,
                111.723,
                111.967,
                112.303,
                112.524,
                112.791,
                113.186,
                113.348,
                113.673,
                113.905,
                114.161,
                114.44,
                114.707,
                115.09,
                115.31,
                115.531,
                115.763,
                115.937,
                116.088,
                116.32,
                116.471,
                116.622,
                116.889,
                117.203,
                117.412,
                117.725,
                117.957,
                118.271,
                118.503,
                118.654,
                118.817,
                118.921,
                119.072,
                119.455,
                119.629,
                119.908,
                120.163,
                120.326,
                120.454,
                120.558,
                120.721,
                120.999,
                121.255,
                121.522,
                121.777,
                122.079,
                122.474,
                122.625,
                122.799,
                122.984,
                123.101,
                123.205,
                123.379,
                123.484,
                123.913,
                124.111,
                124.366,
                124.587,
                124.958,
                125.214,
                125.423,
                125.585,
                125.782,
                126.026,
                126.386,
                126.549,
                126.862,
                126.967,
                127.303,
                127.42,
                127.977,
                128.093,
                128.279,
                128.557,
                128.731,
                129.01,
                130.241,
                130.914,
                131.762,
                131.947,
                132.54,
                133.097,
                134.397,
                134.908,
                135.268,
                135.581,
                136.127,
                136.394,
                137.451,
                137.95,
                138.298,
                138.612,
                138.844,
                139.029,
                139.238,
                139.424,
                139.633,
                139.842,
                140.156,
                140.446,
                140.597,
                140.783
              ],
              "musicSnareHits": [
                0.035,
                0.313,
                0.557,
                0.731,
                0.987,
                1.242,
                1.393,
                1.637,
                1.811,
                2.067,
                2.357,
                2.612,
                2.902,
                3.181,
                3.425,
                3.82,
                4.029,
                4.365,
                4.528,
                4.679,
                4.923,
                5.097,
                5.352,
                5.608,
                6.002,
                6.177,
                6.42,
                6.734,
                6.978,
                7.268,
                7.546,
                7.79,
                8.081,
                8.464,
                8.731,
                8.905,
                9.16,
                9.439,
                9.729,
                9.985,
                10.368,
                10.797,
                11.204,
                11.459,
                11.622,
                11.935,
                12.156,
                12.446,
                12.725,
                12.98,
                13.27,
                13.526,
                13.816,
                14.083,
                14.35,
                14.733,
                14.93,
                15.163,
                15.72,
                15.999,
                16.405,
                16.649,
                16.916,
                17.183,
                17.357,
                17.891,
                18.158,
                18.448,
                18.704,
                18.855,
                19.087,
                19.377,
                19.644,
                19.934,
                20.19,
                20.352,
                20.631,
                20.886,
                21.177,
                21.455,
                21.711,
                21.989,
                22.245,
                22.547,
                22.814,
                23.069,
                23.452,
                23.638,
                23.893,
                24.288,
                24.555,
                24.718,
                25.02,
                25.252,
                25.53,
                25.809,
                26.088,
                26.389,
                26.622,
                26.9,
                27.167,
                27.434,
                27.725,
                28.015,
                28.247,
                28.653,
                28.804,
                29.071,
                29.385,
                29.617,
                29.907,
                30.221,
                30.43,
                30.72,
                30.975,
                31.266,
                31.533,
                31.8,
                32.183,
                32.369,
                32.612,
                32.891,
                33.17,
                33.448,
                33.727,
                33.982,
                34.249,
                34.54,
                34.807,
                35.085,
                35.352,
                35.619,
                35.898,
                36.165,
                36.548,
                36.827,
                36.989,
                37.28,
                37.535,
                37.802,
                38.069,
                38.348,
                38.638,
                38.87,
                39.033,
                39.277,
                39.451,
                39.706,
                39.996,
                40.275,
                40.519,
                40.67,
                40.914,
                41.355,
                41.749,
                41.9,
                42.167,
                42.446,
                42.701,
                42.992,
                43.363,
                43.526,
                43.828,
                44.083,
                44.35,
                44.629,
                44.884,
                45.267,
                45.43,
                45.825,
                46.022,
                46.254,
                46.533,
                46.846,
                47.067,
                47.462,
                47.613,
                47.763,
                47.996,
                48.158,
                48.321,
                48.553,
                48.715,
                48.994,
                49.25,
                49.633,
                50.074,
                50.318,
                50.492,
                50.736,
                50.887,
                51.177,
                51.432,
                51.699,
                52.106,
                52.257,
                52.814,
                53.174,
                53.371,
                53.626,
                53.998,
                54.555,
                54.846,
                54.996,
                55.38,
                55.577,
                55.809,
                56.088,
                56.483,
                56.738,
                56.9,
                57.168,
                57.562,
                57.841,
                57.992,
                58.375,
                58.921,
                59.095,
                59.35,
                59.733,
                59.942,
                60.175,
                60.453,
                60.836,
                61.092,
                61.324,
                61.533,
                61.916,
                62.09,
                62.357,
                62.729,
                62.903,
                63.286,
                63.716,
                64.099,
                64.284,
                64.551,
                64.819,
                65.26,
                65.469,
                65.898,
                66.281,
                66.572,
                66.92,
                67.094,
                67.64,
                67.942,
                68.197,
                68.464,
                68.661,
                68.894,
                69.137,
                69.567,
                69.822,
                69.985,
                70.275,
                70.658,
                70.925,
                71.1,
                71.471,
                71.738,
                71.924,
                72.156,
                72.469,
                72.829,
                73.108,
                73.271,
                73.642,
                74.188,
                74.466,
                74.641,
                74.908,
                75.291,
                75.465,
                75.836,
                76.115,
                76.37,
                76.684,
                76.928,
                77.09,
                77.462,
                77.648,
                77.915,
                78.53,
                78.994,
                79.273,
                79.644,
                79.819,
                80.19,
                80.364,
                80.631,
                80.922,
                81.177,
                81.456,
                81.734,
                82.001,
                82.268,
                82.547,
                82.709,
                82.918,
                83.197,
                83.36,
                83.638,
                83.917,
                84.196,
                84.451,
                84.73,
                84.997,
                85.519,
                85.786,
                86.053,
                86.204,
                86.46,
                86.727,
                86.901,
                87.179,
                87.458,
                87.713,
                87.98,
                88.259,
                88.514,
                88.909,
                89.199,
                89.35,
                89.652,
                89.803,
                90.012,
                90.186,
                90.442,
                90.709,
                90.999,
                91.254,
                91.521,
                91.8,
                92.09,
                92.346,
                92.729,
                92.891,
                93.275,
                93.425,
                93.716,
                93.994,
                94.273,
                94.528,
                94.912,
                95.062,
                95.364,
                95.724,
                95.898,
                96.444,
                96.723,
                96.99,
                97.257,
                97.64,
                97.802,
                98.081,
                98.325,
                98.627,
                98.882,
                99.289,
                99.718,
                99.985,
                100.264,
                100.519,
                100.798,
                101.053,
                101.46,
                101.611,
                102.005,
                102.156,
                102.446,
                102.992,
                103.259,
                103.642,
                103.805,
                104.06,
                104.339,
                104.629,
                105.175,
                105.442,
                105.709,
                105.976,
                106.371,
                106.649,
                106.916,
                107.114,
                107.357,
                107.613,
                107.892,
                108.17,
                108.449,
                108.704,
                108.983,
                109.238,
                109.54,
                109.784,
                110.19,
                110.341,
                110.736,
                110.887,
                111.166,
                111.456,
                111.723,
                111.99,
                112.303,
                112.524,
                112.814,
                113.186,
                113.348,
                113.673,
                113.905,
                114.161,
                114.44,
                114.707,
                115.09,
                115.531,
                115.763,
                115.937,
                116.088,
                116.355,
                116.622,
                116.889,
                117.284,
                117.47,
                117.725,
                117.957,
                118.271,
                118.503,
                118.654,
                118.817,
                119.072,
                119.455,
                119.629,
                119.908,
                120.163,
                120.454,
                120.721,
                120.999,
                121.255,
                121.522,
                121.812,
                122.079,
                122.625,
                123.101,
                123.484,
                124.366,
                124.656,
                124.97,
                125.225,
                125.457,
                125.794,
                126.386,
                126.549,
                126.862,
                127.42,
                128.093,
                128.557,
                128.731,
                129.01,
                130.241,
                130.914,
                133.097,
                134.397,
                135.268,
                136.406,
                137.451,
                138.298,
                138.855,
                139.424,
                139.656,
                140.156,
                140.446,
                140.783
              ],
              "musicBassHits": [
                0.441,
                0.824,
                1.265,
                1.649,
                2.078,
                2.624,
                3.019,
                3.448,
                3.831,
                4.377,
                4.818,
                5.19,
                5.631,
                6.014,
                6.56,
                7.001,
                7.372,
                7.814,
                8.185,
                8.731,
                9.172,
                9.567,
                9.822,
                9.996,
                10.368,
                10.797,
                11.355,
                11.738,
                12.005,
                12.167,
                12.562,
                13.096,
                13.537,
                13.92,
                14.187,
                14.35,
                14.733,
                14.93,
                15.174,
                15.72,
                16.103,
                16.544,
                16.927,
                17.194,
                17.38,
                17.903,
                18.17,
                18.553,
                18.715,
                19.098,
                19.296,
                19.54,
                19.9,
                20.085,
                20.364,
                20.643,
                20.886,
                21.223,
                21.455,
                21.722,
                21.954,
                22.268,
                22.57,
                22.918,
                23.081,
                23.464,
                23.673,
                23.905,
                24.137,
                24.3,
                24.451,
                24.752,
                25.101,
                25.263,
                25.542,
                25.774,
                25.925,
                26.192,
                26.424,
                26.633,
                26.889,
                27.283,
                27.458,
                27.818,
                28.015,
                28.247,
                28.584,
                28.804,
                29.095,
                29.466,
                29.629,
                30,
                30.546,
                30.778,
                30.987,
                31.231,
                31.382,
                31.649,
                31.8,
                32.183,
                32.403,
                32.624,
                32.868,
                33.181,
                33.553,
                33.727,
                33.994,
                34.215,
                34.366,
                34.551,
                34.818,
                35.039,
                35.364,
                35.631,
                35.91,
                36.165,
                36.444,
                36.711,
                36.989,
                37.222,
                37.535,
                37.767,
                37.93,
                38.081,
                38.348,
                38.638,
                38.87,
                39.044,
                39.277,
                39.486,
                39.718,
                39.95,
                40.101,
                40.368,
                40.53,
                40.914,
                41.366,
                41.61,
                41.761,
                42.017,
                42.202,
                42.551,
                42.713,
                43.003,
                43.224,
                43.526,
                43.804,
                44.083,
                44.35,
                44.733,
                44.896,
                45.279,
                45.476,
                45.825,
                46.126,
                46.382,
                46.544,
                46.916,
                47.078,
                47.311,
                47.462,
                48.007,
                48.17,
                48.448,
                48.774,
                49.099,
                49.25,
                49.459,
                49.644,
                49.83,
                50.097,
                50.318,
                50.631,
                50.887,
                51.281,
                51.444,
                51.827,
                51.978,
                52.233,
                52.547,
                52.814,
                53.081,
                53.383,
                53.534,
                53.731,
                54.01,
                54.393,
                54.555,
                54.834,
                54.996,
                55.217,
                55.38,
                55.589,
                55.809,
                55.96,
                56.192,
                56.494,
                56.738,
                56.9,
                57.179,
                57.562,
                57.841,
                57.992,
                58.143,
                58.375,
                58.932,
                59.106,
                59.362,
                59.524,
                59.733,
                60.175,
                60.407,
                60.558,
                60.929,
                61.103,
                61.544,
                61.893,
                62.148,
                62.357,
                62.74,
                62.984,
                63.286,
                63.716,
                64.099,
                64.284,
                64.551,
                64.923,
                65.48,
                65.898,
                66.281,
                66.467,
                66.723,
                67.106,
                67.442,
                67.651,
                67.884,
                68.081,
                68.255,
                68.464,
                68.905,
                69.149,
                69.648,
                69.822,
                69.985,
                70.194,
                70.38,
                70.531,
                70.705,
                70.937,
                71.088,
                71.285,
                71.471,
                71.645,
                71.924,
                72.295,
                72.562,
                72.853,
                73.108,
                73.282,
                73.468,
                73.642,
                74.025,
                74.199,
                74.374,
                74.745,
                74.942,
                75.291,
                75.511,
                75.836,
                76.37,
                76.684,
                76.928,
                77.195,
                77.462,
                77.752,
                78.019,
                78.541,
                78.878,
                79.099,
                79.285,
                79.435,
                79.644,
                79.83,
                80.202,
                80.747,
                80.922,
                81.293,
                81.572,
                81.734,
                82.013,
                82.373,
                82.547,
                82.814,
                83.197,
                83.36,
                83.592,
                83.754,
                83.905,
                84.114,
                84.567,
                85.101,
                85.252,
                85.519,
                85.775,
                85.925,
                86.227,
                86.46,
                86.634,
                86.912,
                87.11,
                87.284,
                87.725,
                88.004,
                88.271,
                88.514,
                88.921,
                89.199,
                89.35,
                89.583,
                89.908,
                90.175,
                90.453,
                90.709,
                91.011,
                91.231,
                91.521,
                91.777,
                92.09,
                92.323,
                92.473,
                92.74,
                92.891,
                93.286,
                93.727,
                93.96,
                94.273,
                94.575,
                94.923,
                95.074,
                95.364,
                95.736,
                95.898,
                96.131,
                96.456,
                96.723,
                96.885,
                97.106,
                97.268,
                97.64,
                97.802,
                98.093,
                98.313,
                98.627,
                98.859,
                99.01,
                99.277,
                99.439,
                99.718,
                99.985,
                100.264,
                100.809,
                101.053,
                101.204,
                101.46,
                101.622,
                102.005,
                102.214,
                102.458,
                102.679,
                102.992,
                103.294,
                103.642,
                103.805,
                104.083,
                104.316,
                104.478,
                104.629,
                104.966,
                105.175,
                105.442,
                105.72,
                105.987,
                106.371,
                106.649,
                106.8,
                107.032,
                107.357,
                107.601,
                107.903,
                108.17,
                108.449,
                108.704,
                108.983,
                109.238,
                109.54,
                109.842,
                110.19,
                110.341,
                110.736,
                110.91,
                111.177,
                111.409,
                111.723,
                111.967,
                112.373,
                112.536,
                112.791,
                113.186,
                113.348,
                113.697,
                113.905,
                114.173,
                114.451,
                114.718,
                115.101,
                115.31,
                115.542,
                115.763,
                116.088,
                116.32,
                116.471,
                116.634,
                116.901,
                117.203,
                117.412,
                117.725,
                117.957,
                118.271,
                118.503,
                118.654,
                118.921,
                119.072,
                119.467,
                119.641,
                119.908,
                120.163,
                120.326,
                120.558,
                120.755,
                120.999,
                121.278,
                121.533,
                121.777,
                122.091,
                122.474,
                122.636,
                122.799,
                122.984,
                123.205,
                123.379,
                123.913,
                124.111,
                124.378,
                124.587,
                124.958,
                125.214,
                125.423,
                125.585,
                125.782,
                126.026,
                126.386,
                126.56,
                126.967,
                127.303,
                127.977,
                128.279,
                128.731,
                130.914,
                131.762,
                131.947,
                132.54,
                133.097,
                134.908,
                135.279,
                135.581,
                136.127,
                136.394,
                137.462,
                137.95,
                138.298,
                138.612,
                138.844,
                139.029,
                139.238,
                139.424,
                139.633,
                139.842,
                140.167,
                140.446,
                140.597
              ],
              "voiceId": "ZhPmsZkhfa4TFVBOBDbS",
              "price": "2500000",
              "city": "Beverly Hills",
              "address": "123 Luxury Lane",
              "mainSellingPoints": [
                "Rodeo Drive",
                "Beverly Hills Hotel",
                "Greystone Mansion"
              ],
              "size": "3500",
              "bedroomCount": "4",
              "bathroomCount": "3",
              "lotSize": "0.5 acres",
              "propertyType": "single_family",
              "preferredTone": "engaging",
              "useMusic": "yes",
              "webhookResponse": [
                "Welcome to 123 Luxury Lane, where modern elegance meets breathtaking panoramic city views. This stunning estate invites you to explore its enchanting outdoor spaces, beginning with a private dock complete with a boat lift, offering serene waterfront views and a spacious dock area.",
                "Step into paradise on the waterfront patio, featuring a charming Tiki hut and comfortable outdoor seating that seamlessly blend with the vibrant landscape. The cozy backyard, adorned with swaying palm trees and casual seating, offers direct access to the water, creating an idyllic setting for relaxation. Adjacent to this oasis is a covered patio with a thatched roof, perfect for dining al fresco with the tranquil water as your backdrop. As you take in the lush surroundings and expansive water views, imagine yourself unwinding in this perfect relaxation area. Now let's head inside...",
                "Inside, the living room captivates with its large windows framing exquisite water views. Comfortable seating and an open layout create a welcoming space for gathering. The open kitchen, complete with stainless steel appliances and custom cabinetry, seamlessly connects to the dining area, allowing easy access to the outdoor scenery. The modern kitchen boasts granite countertops, a double oven, and a central island, making it a chef's dream. The private retreat begins...",
                "The master bedroom offers a serene escape, featuring plush carpeting, a ceiling fan, and a luxurious ensuite bathroom. Each guest bedroom continues the theme of comfort, with its own ensuite, ensuring privacy and relaxation. The modern bathroom is a masterpiece of design with a vessel sink, marble countertops, and stylish tile accents.",
                "This captivating residence at 123 Luxury Lane invites you to experience the epitome of Beverly Hills living, just moments from Rodeo Drive, the iconic Beverly Hills Hotel, and the historic Greystone Mansion. To make this dream home yours, contact us at (310) 555-0123 or follow @luxuryhomes. Your luxurious lifestyle awaits."
              ],
              "agentName": "Jane Smith",
              "agentPhone": "(310) 555-0123",
              "agentEmail": "jane@luxuryrealty.com",
              "agentCta": "Schedule a Private Tour",
              "logoUrl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/branding/d7f5b65e-27ba-45f9-87cf-37495ce34917/logo-NvUINHbuxtgl43EvHQd0I.jpg",
              "headshotUrl": "https://qjkgsiqcqkkuhawuqvve.supabase.co/storage/v1/object/public/listing-images/branding/d7f5b65e-27ba-45f9-87cf-37495ce34917/photo-dxNkIzphHiCvJ6zIftdvJ.jpg",
              "estimatedNarrationDuration": 124,
              "sectionImageMapping": [
                {
                  "sectionIndex": 0,
                  "sectionType": "opening",
                  "imageIndices": [
                    5
                  ],
                  "wordCount": 43,
                  "estimatedDuration": 18
                },
                {
                  "sectionIndex": 1,
                  "sectionType": "outdoor",
                  "imageIndices": [
                    0,
                    1,
                    2,
                    3,
                    4
                  ],
                  "wordCount": 93,
                  "estimatedDuration": 38
                },
                {
                  "sectionIndex": 2,
                  "sectionType": "living",
                  "imageIndices": [
                    5,
                    6,
                    7
                  ],
                  "wordCount": 71,
                  "estimatedDuration": 29
                },
                {
                  "sectionIndex": 3,
                  "sectionType": "private",
                  "imageIndices": [
                    8,
                    9,
                    10
                  ],
                  "wordCount": 52,
                  "estimatedDuration": 21
                },
                {
                  "sectionIndex": 4,
                  "sectionType": "closing",
                  "imageIndices": [
                    0,
                    1,
                    2,
                    3,
                    4
                  ],
                  "wordCount": 50,
                  "estimatedDuration": 20
                }
              ],
              "videoId": "3205b857-a009-4942-b15f-2964f9216ee5"
            }
          ],
          "webhookUrl": "https://edgeaimedia.app.n8n.cloud/webhook/db085427-02a1-4f47-9934-9c258aa929b3",
          "executionMode": "production"
        },
        "pairedItem": {
          "item": 0
        }
      }
    ]
  },
  "versionId": "1fddadf9-828e-4da4-951f-bf3119ff4e63",
  "activeVersionId": "1fddadf9-828e-4da4-951f-bf3119ff4e63",
  "versionCounter": 260,
  "triggerCount": 1,
  "shared": [
    {
      "updatedAt": "2026-01-13T23:28:53.822Z",
      "createdAt": "2026-01-13T23:28:53.822Z",
      "role": "workflow:owner",
      "workflowId": "Qo2sirL0cDI2fVNQMJ5Eq",
      "projectId": "rir8MSIWoGDNYiqe",
      "project": {
        "updatedAt": "2025-03-09T23:16:25.038Z",
        "createdAt": "2025-03-09T23:16:22.800Z",
        "id": "rir8MSIWoGDNYiqe",
        "name": "Shawheen Nabizadeh <shawheendn@gmail.com>",
        "type": "personal",
        "icon": null,
        "description": null,
        "creatorId": "92d3fbdb-a49c-432b-b35c-b3d875346f08",
        "projectRelations": [
          {
            "updatedAt": "2025-03-09T23:16:22.800Z",
            "createdAt": "2025-03-09T23:16:22.800Z",
            "userId": "92d3fbdb-a49c-432b-b35c-b3d875346f08",
            "projectId": "rir8MSIWoGDNYiqe",
            "user": {
              "updatedAt": "2026-01-15T08:01:12.000Z",
              "createdAt": "2025-03-09T23:16:20.905Z",
              "id": "92d3fbdb-a49c-432b-b35c-b3d875346f08",
              "email": "shawheendn@gmail.com",
              "firstName": "Shawheen",
              "lastName": "Nabizadeh",
              "personalizationAnswers": null,
              "settings": {
                "userActivated": true,
                "easyAIWorkflowOnboarded": true,
                "firstSuccessfulWorkflowId": "xgyizZxdSJZuM16J",
                "userActivatedAt": 1749947407381,
                "npsSurvey": {
                  "responded": true,
                  "lastShownAt": 1753068671039
                }
              },
              "disabled": false,
              "mfaEnabled": false,
              "lastActiveAt": "2026-01-15",
              "isPending": false
            }
          }
        ]
      }
    }
  ],
  "tags": [],
  "activeVersion": {
    "updatedAt": "2026-01-16T07:34:01.417Z",
    "createdAt": "2026-01-16T07:34:01.417Z",
    "versionId": "1fddadf9-828e-4da4-951f-bf3119ff4e63",
    "workflowId": "Qo2sirL0cDI2fVNQMJ5Eq",
    "nodes": [
      {
        "parameters": {
          "content": "## Generate Video\n",
          "height": 80,
          "width": 320
        },
        "type": "n8n-nodes-base.stickyNote",
        "position": [
          43968,
          15184
        ],
        "typeVersion": 1,
        "id": "aca2c070-b9e1-40de-bac4-1485972163e7",
        "name": "Sticky Note2"
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "c7ce3d37-6455-407a-bf57-286d91c16f97",
                "name": "video_url",
                "value": "={{ $json.movie.url }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          88048,
          29648
        ],
        "id": "71aafb98-7f4c-477b-a0fe-c8a8544bbdb1",
        "name": "Output final video"
      },
      {
        "parameters": {
          "sendTo": "={{ $('Webhook').first().json.body[0].email }}",
          "subject": "Your Property Video is Ready!",
          "message": "=Hi there!\n\nGreat news - your property video has been generated successfully!\n\nYou can view and download your video here:\n{{ $json.movie.url }}\n\nThank you for using our service!\n\nBest regards,\nEdge AI Video Team",
          "options": {}
        },
        "type": "n8n-nodes-base.gmail",
        "typeVersion": 2.1,
        "position": [
          88272,
          29824
        ],
        "id": "1c55a048-e89b-405d-8436-330d7c59dc20",
        "name": "ðŸŽ‰ Send video URL",
        "webhookId": "a4fb50cc-107d-4525-b37e-94b4abd7f0e3",
        "credentials": {
          "gmailOAuth2": {
            "id": "LgTVoHWwrV9qYrJH",
            "name": "Gmail account"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://y-tvideo-mvp-m2dz.vercel.app/api/videos/complete",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer 0f293a3e6502cda70445cb70b744afbc42356b4feec619ce937f305c15332b77"
              },
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify({ video_id: $('Webhook').first().json.body[0].videoId, video_url: $json.video_url, status: 'completed', execution_id: $execution.id }) }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          88272,
          29472
        ],
        "id": "1c3cda16-6a4b-49be-9132-ffe8d8ef28cf",
        "name": "HTTP Request"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://backend.edgeairealty.com/api/video/track-execution",
          "sendBody": true,
          "bodyParameters": {
            "parameters": [
              {
                "name": "executionId",
                "value": "={{ $execution.id }}"
              },
              {
                "name": "email",
                "value": "={{ $json.body[0].email }}"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          77472,
          29504
        ],
        "id": "ff161925-d657-4644-bc9f-08b49368c274",
        "name": "save execution id to db",
        "disabled": true
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.json2video.com/v2/movies",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "contentType": "raw",
          "rawContentType": "application/json",
          "body": "={\n  \"comment\": \"Final video with captions and end card\",\n  \"resolution\": \"custom\",\n  \"width\": 1080,\n  \"height\": 1920,\n  \"quality\": \"high\",\n  \"scenes\": [\n    {\n      \"comment\": \"Main video scene with captions\",\n      \"duration\": {{ Number($json.video_duration) || 100 }},\n      \"elements\": [\n        {\n          \"type\": \"video\",\n          \"src\": \"{{ $json.video }}\"\n        },\n        {\n          \"type\": \"subtitles\",\n          \"language\": \"\",\n          \"start\": 0,\n          \"style\": \"classic-progressive\",\n          \"position\": \"bottom-center\",\n          \"y\": 1400,\n          \"font-family\": \"Roboto\",\n          \"font-size\": \"60px\",\n          \"font-weight\": \"700\",\n          \"color\": \"#FFFFFF\",\n          \"background-color\": \"rgba(0,0,0,0.6)\"\n        }\n      ]\n    },\n    {\n      \"comment\": \"Closing card - agent branding\",\n      \"duration\": 6,\n      \"background-color\": \"#FFFFFF\",\n      \"elements\": [\n        {\n          \"type\": \"image\",\n          \"src\": \"{{ $json.headshot_url }}\",\n          \"start\": 0.3,\n          \"duration\": 5.7,\n          \"x\": 390,\n          \"y\": 500,\n          \"width\": 300,\n          \"height\": 300,\n          \"style\": \"circle\",\n          \"fade-in\": 0.5\n        },\n        {\n          \"type\": \"text\",\n          \"text\": \"{{ $json.agent_name }}\",\n          \"start\": 0.6,\n          \"duration\": 5.4,\n          \"x\": 0,\n          \"y\": 880,\n          \"width\": 1080,\n          \"settings\": {\n            \"font-family\": \"Roboto\",\n            \"font-size\": \"56px\",\n            \"font-weight\": \"700\",\n            \"color\": \"#1A1A1A\",\n            \"text-align\": \"center\"\n          },\n          \"fade-in\": 0.4\n        },\n        {\n          \"type\": \"text\",\n          \"text\": \"{{ $json.brand_name }}\",\n          \"start\": 0.9,\n          \"duration\": 5.1,\n          \"x\": 0,\n          \"y\": 960,\n          \"width\": 1080,\n          \"settings\": {\n            \"font-family\": \"Roboto\",\n            \"font-size\": \"28px\",\n            \"font-weight\": \"400\",\n            \"color\": \"#666666\",\n            \"text-align\": \"center\"\n          },\n          \"fade-in\": 0.4\n        },\n        {\n          \"type\": \"text\",\n          \"text\": \"{{ $json.phone }}\",\n          \"start\": 1.2,\n          \"duration\": 4.8,\n          \"x\": 0,\n          \"y\": 1100,\n          \"width\": 1080,\n          \"settings\": {\n            \"font-family\": \"Roboto\",\n            \"font-size\": \"32px\",\n            \"font-weight\": \"500\",\n            \"color\": \"#333333\",\n            \"text-align\": \"center\"\n          },\n          \"fade-in\": 0.5\n        },\n        {\n          \"type\": \"text\",\n          \"text\": \"{{ $json.email }}\",\n          \"start\": 1.5,\n          \"duration\": 4.5,\n          \"x\": 0,\n          \"y\": 1160,\n          \"width\": 1080,\n          \"settings\": {\n            \"font-family\": \"Roboto\",\n            \"font-size\": \"24px\",\n            \"font-weight\": \"400\",\n            \"color\": \"#666666\",\n            \"text-align\": \"center\"\n          },\n          \"fade-in\": 0.5\n        }\n      ]\n    }\n  ]\n}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          87152,
          29648
        ],
        "id": "6662028a-d554-44dc-b420-506a5c0c4372",
        "name": "json2video - Edit video1",
        "credentials": {
          "httpHeaderAuth": {
            "id": "ZmaCE8owCz8ioHlO",
            "name": "json2video"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "2643b070-cbb2-4562-9269-a61389e0c242",
                "leftValue": "={{ $json.movie.status }}",
                "rightValue": "done",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          87824,
          29648
        ],
        "id": "401c7c69-f249-4364-a079-4daedbded16b",
        "name": "Check Errors "
      },
      {
        "parameters": {
          "assignments": {
            "assignments": [
              {
                "id": "var-video",
                "name": "video",
                "value": "={{ $json.movie.url }}",
                "type": "string"
              },
              {
                "id": "var-video-duration",
                "name": "video_duration",
                "value": "={{ $json.movie.duration - 6 }}",
                "type": "number"
              },
              {
                "id": "var-headshot",
                "name": "headshot_url",
                "value": "={{ $('Webhook').first().json.body[0].headshotUrl }}",
                "type": "string"
              },
              {
                "id": "var-agent-name",
                "name": "agent_name",
                "value": "={{ $('Webhook').first().json.body[0].agentName }}",
                "type": "string"
              },
              {
                "id": "var-brand-name",
                "name": "brand_name",
                "value": "={{ $('Webhook').first().json.body[0].brandName || $('Webhook').first().json.body[0].agentName + ' Real Estate' }}",
                "type": "string"
              },
              {
                "id": "var-phone",
                "name": "phone",
                "value": "={{ $('Webhook').first().json.body[0].agentPhone }}",
                "type": "string"
              },
              {
                "id": "var-email",
                "name": "email",
                "value": "={{ $('Webhook').first().json.body[0].agentEmail || $('Webhook').first().json.body[0].email }}",
                "type": "string"
              },
              {
                "id": "var-logo",
                "name": "logo_url",
                "value": "={{ $('Webhook').first().json.body[0].logoUrl }}",
                "type": "string"
              },
              {
                "id": "var-captions",
                "name": "show_captions",
                "value": "={{ $('Webhook').first().json.body[0].showCaptions || 'true' }}",
                "type": "string"
              }
            ]
          },
          "options": {}
        },
        "type": "n8n-nodes-base.set",
        "typeVersion": 3.4,
        "position": [
          86928,
          29648
        ],
        "id": "98ffa0db-fcad-44f5-88e0-a672372c41e8",
        "name": "Format variables for final editing1"
      },
      {
        "parameters": {
          "amount": 10
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          87376,
          29648
        ],
        "id": "6bfa0b28-ba19-4494-ba31-3eaf1a331674",
        "name": "10 sec1",
        "webhookId": "a26e82ce-7ce3-4c35-8c1b-d38d741e5517"
      },
      {
        "parameters": {
          "amount": 10
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          83792,
          29648
        ],
        "id": "a348d831-6f2a-4a73-86cb-d489c9b48ddc",
        "name": "10 sec3",
        "webhookId": "a785c251-3cad-4a14-8459-982605435a38"
      },
      {
        "parameters": {
          "amount": 1
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          78416,
          29648
        ],
        "id": "e377702b-07f8-407b-96d1-0d536646171a",
        "name": "Wait 30 sec1",
        "webhookId": "77b845bd-e51b-4251-be3f-0a35c9c33b73"
      },
      {
        "parameters": {
          "amount": 30
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          84912,
          29648
        ],
        "id": "6f4111b7-d6fb-43a4-afd2-4ffa133af7ca",
        "name": "30 sec2",
        "webhookId": "80f025e0-e388-4a80-8b4c-1a13950f84c7"
      },
      {
        "parameters": {
          "jsCode": "// Get the images array\nconst images = $input.first().json.body[0].images\n\n// Return each image as a separate item\nreturn images.map(image => ({\n  json: {\n    imageurl: image.imageurl,\n  \n  }\n}));"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          77472,
          29792
        ],
        "id": "9ebfc7e0-1c7d-4e8c-b5db-3610540cd1ac",
        "name": "Separate image data"
      },
      {
        "parameters": {
          "url": "=https://api.json2video.com/v2/movies?id={{ $('json2video - Edit video1').item.json.project }}",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          87600,
          29648
        ],
        "id": "b439fc41-6315-4e23-ab65-62b30d26aaf4",
        "name": "caption generation",
        "credentials": {
          "httpHeaderAuth": {
            "id": "ZmaCE8owCz8ioHlO",
            "name": "json2video"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "=https://api.elevenlabs.io/v1/text-to-speech/{{ $('Webhook').first().json.body[0].voiceId }}",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify({ text: $json.text, model_id: \"eleven_multilingual_v2\", voice_settings: { stability: 0.5, similarity_boost: 0.75 } }) }}",
          "options": {
            "response": {
              "response": {
                "responseFormat": "file"
              }
            }
          }
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          80208,
          29648
        ],
        "id": "02687d69-da7a-4762-8e11-e651c33c6d5e",
        "name": "Convert text to speech",
        "credentials": {
          "httpHeaderAuth": {
            "id": "rKfEcb8VGDJowZG5",
            "name": "Eleven Labs"
          }
        }
      },
      {
        "parameters": {
          "url": "=https://api.json2video.com/v2/movies?id={{ $('Call jsontovideo to render').item.json.project }}",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          86480,
          29648
        ],
        "id": "dcd0b02c-2c24-4b81-808d-b6149ac0a249",
        "name": "Get final video status",
        "credentials": {
          "httpHeaderAuth": {
            "id": "ZmaCE8owCz8ioHlO",
            "name": "json2video"
          }
        }
      },
      {
        "parameters": {
          "amount": 30
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          86256,
          29648
        ],
        "id": "507cc1d2-20c2-4883-be96-f557368895c3",
        "name": "30 sec",
        "webhookId": "80f025e0-e388-4a80-8b4c-1a13950f84c7"
      },
      {
        "parameters": {
          "amount": 30
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          81328,
          29648
        ],
        "id": "61e14c86-f6b6-4473-a25d-a6c169db265f",
        "name": "Wait 30 sec3",
        "webhookId": "cecadd7e-cb24-46a8-8889-a7ddedf4e3ff"
      },
      {
        "parameters": {
          "amount": 30
        },
        "type": "n8n-nodes-base.wait",
        "typeVersion": 1.1,
        "position": [
          82672,
          29648
        ],
        "id": "0725448f-ad1c-4411-b3f0-d27c3497e0ac",
        "name": "30 sec3",
        "webhookId": "0ef02fcf-1b28-452f-8a7f-edbecd24b004"
      },
      {
        "parameters": {
          "jsCode": "const items = $input.all();\n\nconst grouped = [];\nlet groupIndex = 1;\n\nfor (let i = 0; i < items.length; i += 1) {\n  const groupItems = items.slice(i, i + 1);\n\n  // Parse image URLs\n  const images = groupItems.map(item => {\n    const result = JSON.parse(item.json.data.resultJson);\n    return result.resultUrls[0];\n  });\n\n\n  grouped.push({\n    json: {\n      images: images,\n    }\n  });\n\n  groupIndex++;\n}\n\n// Return grouped items with duration\nreturn grouped;\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          79312,
          29648
        ],
        "id": "870ee445-139a-4ef9-99cd-bf136fb349c6",
        "name": "Make Optimized Images Array from Nano-banana"
      },
      {
        "parameters": {
          "jsCode": "// âœ… Get all items from both nodes\nconst request2Items = $input.all();\nconst request1Items = $items(\"Create task on kie to optimize images\");\n\n// Flatten their JSON data\nconst request2Data = request2Items.map(item => item.json);\nconst request1Data = request1Items.map(item => item.json);\n\n// Check states\nconst hasFailed = request2Data.some(r => r?.data?.state === \"fail\");\nconst allSuccess = request2Data.every(r => r?.data?.state === \"success\");\n\nif (hasFailed) {\n  // âŒ Terminate workflow immediately\n  throw new Error(\"âŒ One or more items have failed. Stopping execution.\");\n}\n\nif (allSuccess) {\n  // âœ… All succeeded â€” append status \"success\"\n  let successData = request2Data.map(item => ({\n    json: {\n      ...item,\n      status: \"success\",\n    },\n  }));\n\n  // ðŸ”¹ Duplicate the first item and add to end\n  const firstItemCopy = {\n    json: {\n      ...successData[0].json\n    }\n  };\n  successData.push(firstItemCopy);\n\n  return successData;\n} else {\n  // â³ Some still running â€” append status \"pending\"\n  return request1Data.map(item => ({\n    json: {\n      ...item,\n      status: \"pending\",\n    },\n  }));\n}\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          78864,
          29648
        ],
        "id": "7645c9ce-1e12-4694-aa27-8150878bf06a",
        "name": "Standerdize Response"
      },
      {
        "parameters": {
          "url": "https://api.kie.ai/api/v1/jobs/recordInfo",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "taskId",
                "value": "={{ $json.data.taskId }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer e46522bee7b4aebb303feeb54eb8e32e"
              },
              {
                "name": "Cookie",
                "value": "JSESSIONID=9418A560CB6F2F16E797A92ADDCC3F4B"
              },
              {
                "name": "cookie",
                "value": "JSESSIONID=9418A560CB6F2F16E797A92ADDCC3F4B;"
              }
            ]
          },
          "options": {
            "redirect": {
              "redirect": {}
            }
          }
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          78640,
          29648
        ],
        "id": "ca118dab-6d76-49c1-8191-408248a36d33",
        "name": "Get image from kie"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.kie.ai/api/v1/jobs/createTask",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer e46522bee7b4aebb303feeb54eb8e32e"
              },
              {
                "name": "Cookie",
                "value": "JSESSIONID=9418A560CB6F2F16E797A92ADDCC3F4B"
              },
              {
                "name": "Cookie",
                "value": "JSESSIONID=9418A560CB6F2F16E797A92ADDCC3F4B;"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={\n  \"model\": \"google/nano-banana-edit\",\n  \"input\": {\n    \"image_urls\": [\"{{ $json.imageurl }}\"],\n    \"prompt\": \"Take the provided image of any size and convert it to vertical 9:16 aspect ratio (1080Ã—1920).Keep the main subject perfectly centered.Automatically fill extra space (top, bottom, or sides) naturally to make it a full vertical HD image.Preserve all colors, textures, details, and lighting of the original image.Do not crop or distort the main subject.Output should be high definition, clean, and realistic, ready for Reels/TikTok.\",\n    \"output_format\": \"png\",\n    \"image_size\": \"9:16\"\n  }\n} ",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          77744,
          29648
        ],
        "id": "2ad5ad30-5a77-4306-925e-35fa0d962a4f",
        "name": "Create task on kie to optimize images"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "success-condition",
                "leftValue": "={{ $json.status }}",
                "rightValue": "success",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              },
              {
                "id": "error-condition",
                "leftValue": "={{ $json.status }}",
                "rightValue": "error",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              },
              {
                "id": "failed-condition",
                "leftValue": "={{ $json.status }}",
                "rightValue": "failed",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "or"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          79088,
          29648
        ],
        "id": "2c66163b-9d6d-4491-8d5b-2602197bd389",
        "name": "If Status is Success Go Otherwise Wait",
        "alwaysOutputData": false
      },
      {
        "parameters": {
          "jsCode": "// Get grouped data\nconst grouped = $input.all().map(item => item.json);\n\n// ---------- PROPERTY INFO ----------\nconst property = $('Webhook').first().json.body[0];\nconst propertyType = property.propertyType;\nconst city = property.city;\nconst price = `$${property.price}`;\nconst BedRoom = property.bedroomCount || '';\nconst RestRoom = property.bathroomCount || '';\nconst mainSellingPoints = property.mainSellingPoints || [];\nconst squareFeet = property.size || '';\nconst lotSize = property.lotSize || '';\nconst preferredTone = property.preferredTone || 'enthusiastic';\n\n// Selling points text\nconst sellingPointsText =\n  mainSellingPoints.length === 1\n    ? mainSellingPoints[0]\n    : mainSellingPoints.length === 2\n    ? `${mainSellingPoints[0]} and ${mainSellingPoints[1]}`\n    : `${mainSellingPoints.slice(0, -1).join(', ')} and ${mainSellingPoints[mainSellingPoints.length - 1]}`;\n\nconst roomCountsText = lotSize\n  ? `${BedRoom} bed, ${RestRoom} bath, ${lotSize} lot size`\n  : `${BedRoom} bed, ${RestRoom} bath`;\n\n// Flatten all images for AI context\nconst allImages = grouped.flatMap(g => g.images);\n\n// Convert images to base64 via API (temp URLs not accessible to OpenAI)\nconst base64Response = await fetch('https://y-tvideo-mvp-m2dz.vercel.app/api/images/to-base64', {\n  method: 'POST',\n  headers: {\n    'Content-Type': 'application/json',\n    'Authorization': 'Bearer 0f293a3e6502cda70445cb70b744afbc42356b4feec619ce937f305c15332b77'\n  },\n  body: JSON.stringify({ urls: allImages })\n});\n\nconst base64Data = await base64Response.json();\nconst base64Images = base64Data.images || [];\n\n// Prepare images for AI analysis using base64\nconst imagesForAI = base64Images.map(img => ({\n  type: \"image_url\",\n  image_url: { url: img.base64 }\n}));\n\n// ---------- USER PROMPT WITH 5 PARTS ----------\nconst userPrompt = `\nWrite a real estate short-form script in a ${preferredTone} tone.\n\nThe property is a ${propertyType} in ${city} priced at ${price}.\nMention ${BedRoom} bedrooms, ${RestRoom} bathrooms, ${squareFeet} sq ft, ${roomCountsText},\nand key features (${sellingPointsText}).\n\nUse image cues naturally (do not say \"look at this\" or \"see that\").\n\nSTRUCTURE & OUTPUT FORMAT (VERY IMPORTANT):\n\nWrite the script as EXACTLY 5 parts â€” NO extra versions, NO alternatives.\n\nPart 1 â€” Intro (include price, city, and property type)\nPart 2 â€” Rooms & specs\nPart 3 â€” Image-based description\nPart 4 â€” Motivation â€” highlight key features and images to excite the client\nPart 5 â€” Outro call-to-action\n\nReturn the final output as:\n\n[Part 1 text]\n\\\\n\\\\n\n[Part 2 text]\n\\\\n\\\\n\n[Part 3 text]\n\\\\n\\\\n\n[Part 4 text]\n\\\\n\\\\n\n[Part 5 text]\n\nDo NOT add headings, labels, numbers, brackets, or bullet points.\nTotal length should remain around 100â€“110 words overall (all parts combined).\nKeep it human, smooth, and friendly.\n`;\n\n// ---------- OPENAI API PAYLOAD ----------\nconst apiPayload = {\n  model: \"gpt-4o\",\n  messages: [\n    {\n      role: \"system\",\n      content: `You are an expert real estate copywriter. Produce only one script and follow the exact formatting rules.`\n    },\n    {\n      role: \"user\",\n      content: [\n        ...imagesForAI,\n        { type: \"text\", text: userPrompt }\n      ]\n    }\n  ],\n  temperature: 0.9\n};\n\nreturn { json: apiPayload };\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          79536,
          29648
        ],
        "id": "1f9548d6-5081-47ea-9e95-fff9628e8fdd",
        "name": "Prepare Body for GPT To Analyze Images",
        "disabled": true
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.openai.com/v1/chat/completions",
          "authentication": "predefinedCredentialType",
          "nodeCredentialType": "openAiApi",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ $json }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          79760,
          29648
        ],
        "id": "bfdd831d-ce38-4dff-a826-0e5b2e11f5bb",
        "name": "Call Open AI To Analyze Images And Generate Script Accordingly",
        "credentials": {
          "openAiApi": {
            "id": "t6s7bmAzIhZsEH0A",
            "name": "OpenAi account 2"
          }
        },
        "disabled": true
      },
      {
        "parameters": {
          "jsCode": "// Check if frontend provided script sections (respects user's image order)\nconst webhookResponse = $('Webhook').first().json.body[0].webhookResponse;\n\nif (webhookResponse && webhookResponse.length > 0) {\n  // Use frontend's pre-generated script\n  return webhookResponse.map(text => ({\n    json: { text }\n  }));\n}\n\n// Fallback: use GPT-generated script (legacy path)\nconst content = $input.first().json.choices[0].message.content;\nconst contentArray = content.split('\\n\\n');\nreturn contentArray.map(part => ({\n  json: { text: part }\n}));\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          79984,
          29648
        ],
        "id": "0739a34c-0a42-43a8-881d-1c8a3bdd1370",
        "name": "Split the Script by double newline"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://y-tvideo-mvp-m2dz.vercel.app/api/audio/upload",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "audio/mpeg"
              },
              {
                "name": "Authorization",
                "value": "Bearer 0f293a3e6502cda70445cb70b744afbc42356b4feec619ce937f305c15332b77"
              }
            ]
          },
          "sendBody": true,
          "contentType": "binaryData",
          "inputDataFieldName": "data",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          80432,
          29648
        ],
        "id": "141e090b-e8bb-4c37-95e3-069db7cd3284",
        "name": "Upload Speech To S3"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://y-tvideo-mvp-m2dz.vercel.app/api/audio/duration",
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Content-Type",
                "value": "application/json"
              }
            ]
          },
          "sendBody": true,
          "specifyBody": "json",
          "jsonBody": "={{ JSON.stringify({ url: $json.Location }) }}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          80656,
          29648
        ],
        "id": "5541fafa-d1a3-4490-a949-46aa3a07d773",
        "name": "Get duration of voices"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.kie.ai/api/v1/jobs/createTask",
          "sendHeaders": true,
          "specifyHeaders": "keypair",
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer e46522bee7b4aebb303feeb54eb8e32e"
              },
              {
                "name": "Cookie",
                "value": "JSESSIONID=9418A560CB6F2F16E797A92ADDCC3F4B"
              }
            ]
          },
          "sendBody": true,
          "contentType": "json",
          "specifyBody": "json",
          "jsonBody": "={\n  \"model\": \"kling-2.6/image-to-video\",\n  \"input\": {\n    \"image_urls\": [\"{{ $json.imageurl }}\"],\n    \"prompt\": \"{{ $json.prompt }}\",\n    \"negative_prompt\": \"{{ $json.negative_prompt }}\",\n    \"duration\": \"5\",\n    \"sound\": false\n  }\n}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          81104,
          29648
        ],
        "id": "0ef87ce6-24c6-4152-9f75-811da7fd2849",
        "name": "Call Kie Api Kling Model to Generate image to video",
        "credentials": {
          "httpHeaderAuth": {
            "id": "T1nfcHN1C0bAAIpR",
            "name": "Kie.ai"
          }
        }
      },
      {
        "parameters": {
          "jsCode": "const images = $('Get image from kie').all();\n\n// Kling prompts optimized for real estate - avoid mirroring/reflection artifacts\nconst prompts = [\n  \"Gentle slow zoom-in, subtle forward camera motion over 5 seconds. Maintain original image integrity with no mirroring, no reflections, no distortion. Keep all edges and boundaries stable. Smooth cinematic quality with natural parallax. Preserve exact colors and lighting.\",\n  \"Very subtle left-to-right drift, barely perceptible slow pan over 5 seconds. No warping, no mirroring, no edge distortion. Maintain image fidelity throughout. Gentle ambient motion with stable framing. Keep original composition intact.\",\n  \"Slow gentle push-in with minimal camera movement over 5 seconds. Preserve image exactly as shown with no transformation or reflection effects. Subtle depth animation only. Clean professional real estate video quality.\"\n];\n\n// Negative prompt to avoid unwanted elements\nconst negativePrompt = \"ceiling fan, spinning fan, rotating blades, mirrored image, reflection, distortion, warping, duplicated elements, reversed image, split screen, kaleidoscope effect, morphing, deformation\";\n\nreturn images.map(image => {\n  const parsed = JSON.parse(image.json.data.resultJson);\n  const resultUrl = parsed.resultUrls[0];\n\n  return {\n    json: {\n      imageurl: resultUrl,\n      prompt: prompts[Math.floor(Math.random() * prompts.length)],\n      negative_prompt: negativePrompt\n    }\n  };\n});\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          80880,
          29648
        ],
        "id": "ca41e087-9f4f-4667-89bb-a33e65fce269",
        "name": "Prepare Body for Kie API (Kling model to generate video)"
      },
      {
        "parameters": {
          "url": "https://api.kie.ai/api/v1/jobs/recordInfo",
          "sendQuery": true,
          "queryParameters": {
            "parameters": [
              {
                "name": "taskId",
                "value": "={{ $json.data.taskId }}"
              }
            ]
          },
          "sendHeaders": true,
          "headerParameters": {
            "parameters": [
              {
                "name": "Authorization",
                "value": "Bearer e46522bee7b4aebb303feeb54eb8e32e"
              },
              {
                "name": "Cookie",
                "value": "JSESSIONID=9418A560CB6F2F16E797A92ADDCC3F4B"
              },
              {
                "name": "cookie",
                "value": "JSESSIONID=9418A560CB6F2F16E797A92ADDCC3F4B;"
              }
            ]
          },
          "options": {
            "redirect": {
              "redirect": {}
            }
          }
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          81552,
          29648
        ],
        "id": "52fa8d7c-ddc7-45b3-ac29-5a372970a57a",
        "name": "Get Kie Video Urls"
      },
      {
        "parameters": {
          "jsCode": "// âœ… Get all items from both nodes\nconst request2Items = $input.all();\nconst request1Items = $items(\"Call Kie Api Kling Model to Generate image to video\");\n\n// Flatten their JSON data\nconst request2Data = request2Items.map(item => item.json);\nconst request1Data = request1Items.map(item => item.json);\n\n// Check states\nconst hasFailed = request2Data.some(r => r?.data?.state === \"failed\");\nconst allSuccess = request2Data.every(r => r?.data?.state === \"success\");\n\nif (hasFailed) {\n  // âŒ Terminate workflow immediately\n  throw new Error(\"âŒ One or more items have failed. Stopping execution.\");\n}\n\nif (allSuccess) {\n  // âœ… All succeeded â€” append status \"success\"\n  return request2Data.map(item => ({\n    json: {\n      ...item,\n      status: \"success\",\n    },\n  }));\n} else {\n  // â³ Some still running â€” append status \"pending\"\n  return request1Data.map(item => ({\n    json: {\n      ...item,\n      status: \"pending\",\n    },\n  }));\n}\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          81776,
          29648
        ],
        "id": "9d6768de-e904-4613-af4d-05adfe528f3b",
        "name": "Standerdized Response"
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "strict"
            },
            "conditions": [
              {
                "id": "success-condition",
                "leftValue": "={{ $json.status }}",
                "rightValue": "success",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              },
              {
                "id": "error-condition",
                "leftValue": "={{ $json.status }}",
                "rightValue": "error",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              },
              {
                "id": "failed-condition",
                "leftValue": "={{ $json.status }}",
                "rightValue": "failed",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "or"
          },
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          82000,
          29648
        ],
        "id": "2bc82602-b417-4fc9-ab93-ff2b8ac99717",
        "name": "If Status is Success Go Otherwise Wait1",
        "alwaysOutputData": false
      },
      {
        "parameters": {
          "jsCode": "// Get all Kling video results (flattened)\nconst allItems = $input.all();\n\n// Flatten all URLs into a single array\nconst allUrls = allItems.flatMap(item => {\n  const result = JSON.parse(item.json.data.resultJson);\n  return result.resultUrls || [];\n});\n\n// Define positions (example, repeat if needed)\n\n// Map URLs to JSON output\nreturn allUrls.map((videoUrl, index) => {\n  return {\n    json: {\n      imageVideoUrl: videoUrl\n    }\n  };\n});\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          82224,
          29648
        ],
        "id": "837a7bd0-c5b9-450a-81b9-cbe3a64001f3",
        "name": "Seprate All Video Urls Generatad from Kei"
      },
      {
        "parameters": {
          "url": "=https://api.json2video.com/v2/movies?id={{ $('Render Kie videos in json2video (full duration)').item.json.project }}",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          82896,
          29648
        ],
        "id": "d4c3bd15-0e85-4740-b0e6-d030a1ea739b",
        "name": "Get Video from Jsontovideo",
        "credentials": {
          "httpHeaderAuth": {
            "id": "ZmaCE8owCz8ioHlO",
            "name": "json2video"
          }
        }
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.json2video.com/v2/movies",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "contentType": "raw",
          "rawContentType": "application/json",
          "body": "={\n  \"resolution\": \"custom\",\n  \"quality\": \"high\",\n  \"width\": 1080,\n  \"height\": 1920,\n  \"scenes\": [\n    {\n      \"elements\": [\n        {\n          \"type\": \"video\",\n          \"src\": \"{{ $json.imageVideoUrl }}\",\n          \"start\": 0,\n          \"width\": 1080,\n          \"height\": 1920\n        }\n      ]\n    }\n  ]\n}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          82448,
          29648
        ],
        "id": "f5c5c367-aac1-4a95-ba40-024203da1ef4",
        "name": "Render Kie videos in json2video (full duration)",
        "credentials": {
          "httpHeaderAuth": {
            "id": "ZmaCE8owCz8ioHlO",
            "name": "json2video"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "loose"
            },
            "conditions": [
              {
                "id": "done-condition",
                "leftValue": "={{ $json.movie.status }}",
                "rightValue": "done",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              },
              {
                "id": "error-condition",
                "leftValue": "={{ $json.movie.status }}",
                "rightValue": "error",
                "operator": {
                  "type": "string",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "or"
          },
          "looseTypeValidation": true,
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          83120,
          29648
        ],
        "id": "4a3a7b8f-a956-4cab-8cbc-0299a1f220e7",
        "name": "If status is done go otherwise wait"
      },
      {
        "parameters": {
          "jsCode": "const items = $input.all();\n\n// Extract video URLs\nconst videoUrls = items.map(item => item.json.movie.url);\n\n// Build scenes array - simple structure without transitions\nconst scenes = videoUrls.map((url, index) => ({\n  elements: [\n    {\n      type: \"video\",\n      src: url\n    }\n  ]\n}));\n\n// JSON2Video payload\nconst json2videoPayload = {\n  resolution: \"custom\",\n  width: 1080,\n  height: 1920,\n  quality: \"high\",\n  scenes: scenes\n};\n\nreturn [{ json: json2videoPayload }];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          83344,
          29648
        ],
        "id": "7c8cadad-9c05-4b18-9c65-8b390860dd7a",
        "name": "Make body for jsontovideo Api to merge videos clips"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.json2video.com/v2/movies",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "contentType": "raw",
          "rawContentType": "scenes",
          "body": "={{ $json}}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          83552,
          29648
        ],
        "id": "7095218c-5573-4f82-8a13-0c938c6ce63a",
        "name": "Call Jsontovideo API to merge clips",
        "credentials": {
          "httpHeaderAuth": {
            "id": "ZmaCE8owCz8ioHlO",
            "name": "json2video"
          }
        }
      },
      {
        "parameters": {
          "url": "=https://api.json2video.com/v2/movies?id={{ $('Call Jsontovideo API to merge clips').item.json.project }}",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          84016,
          29648
        ],
        "id": "fa34bbc2-2193-4813-903b-3b75836fca46",
        "name": "Get merged video Status",
        "credentials": {
          "httpHeaderAuth": {
            "id": "ZmaCE8owCz8ioHlO",
            "name": "json2video"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "loose"
            },
            "conditions": [
              {
                "id": "2643b070-cbb2-4562-9269-a61389e0c242",
                "leftValue": "={{ $json.movie.success }}",
                "rightValue": "true",
                "operator": {
                  "type": "boolean",
                  "operation": "true",
                  "singleValue": true
                }
              }
            ],
            "combinator": "and"
          },
          "looseTypeValidation": true,
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          84240,
          29648
        ],
        "id": "ff3a6e2f-26ae-49aa-9466-f3bc7b811308",
        "name": "If status is done go otherwise wait1"
      },
      {
        "parameters": {
          "jsCode": "// ============================================================\n// prepare body for jsontovideo to set video\n// Adds narration audio to merged video clips\n// FIXED: Uses sectionImageMapping for sync - audio plays when its images appear\n// ============================================================\n\nconst movieData = $input.first().json.movie;\n\n// VALIDATION: Ensure we have valid movie data\nif (!movieData) {\n  throw new Error('PIPELINE ERROR: No movie data from merged video.');\n}\nif (!movieData.url) {\n  throw new Error('PIPELINE ERROR: movie.url is undefined. Merged video may have failed. Status: ' + (movieData.status || 'unknown'));\n}\nif (movieData.duration === undefined || movieData.duration === null) {\n  throw new Error('PIPELINE ERROR: movie.duration is undefined. Cannot calculate narration timing.');\n}\n\nconst videoUrl = movieData.url;\nconst videoDuration = Number(movieData.duration);\n\n// VALIDATION: Ensure videoDuration is a valid positive number\nif (isNaN(videoDuration) || videoDuration <= 0) {\n  throw new Error('PIPELINE ERROR: Invalid videoDuration: ' + movieData.duration + '. Must be a positive number.');\n}\n\n// Get audio items\nconst audioItems = $('Get duration of voices').all();\n\nif (!audioItems || audioItems.length === 0) {\n  throw new Error('PIPELINE ERROR: No audio items from Get duration of voices.');\n}\n\nconst audioClips = audioItems.map((a, idx) => {\n  const url = a.json.data?.url;\n  const duration = Number(a.json.data?.duration);\n  if (!url) {\n    throw new Error(`PIPELINE ERROR: Audio clip ${idx} has no URL.`);\n  }\n  if (isNaN(duration) || duration <= 0) {\n    throw new Error(`PIPELINE ERROR: Audio clip ${idx} has invalid duration: ${a.json.data?.duration}`);\n  }\n  return { url, duration };\n});\n\n// ----------------------\n// SECTION-AWARE TIMING\n// ----------------------\nconst CLIP_DURATION = 5; // Each Kling clip = 5 seconds\n\n// Get section-to-image mapping from webhook\nconst webhookData = $('Webhook').first().json.body;\nlet sectionMapping = [];\n\n// Handle both array and single object formats\nif (Array.isArray(webhookData) && webhookData[0]?.sectionImageMapping) {\n  sectionMapping = webhookData[0].sectionImageMapping;\n} else if (webhookData?.sectionImageMapping) {\n  sectionMapping = webhookData.sectionImageMapping;\n}\n\nconsole.log('Section mapping from webhook:', JSON.stringify(sectionMapping, null, 2));\nconsole.log('Audio clips count:', audioClips.length);\nconsole.log('Video duration:', videoDuration, 's');\n\nlet timeline = [];\n\nif (sectionMapping && sectionMapping.length > 0) {\n  // CASE 1: Use section mapping for sync\n  console.log('Strategy: Section-aware timing - audio syncs with image appearance');\n  \n  // Section order from frontend: [opening, outdoor, living, private, closing]\n  // But sectionMapping may have different order based on image assignments\n  \n  for (let i = 0; i < audioClips.length; i++) {\n    const section = sectionMapping[i];\n    const clip = audioClips[i];\n    \n    if (!section || !section.imageIndices || section.imageIndices.length === 0) {\n      // If no section mapping, place after previous clip\n      const lastEnd = timeline.length > 0 \n        ? timeline[timeline.length - 1].start + audioClips[i - 1].duration \n        : 0;\n      console.log(`Section ${i} (${section?.section || 'unknown'}): No image mapping, placing at ${lastEnd}s`);\n      timeline.push({\n        type: 'audio',\n        src: clip.url,\n        start: parseFloat(lastEnd.toFixed(3)),\n        loop: 0,\n        volume: 2\n      });\n      continue;\n    }\n    \n    // Find earliest image in this section\n    const firstImageIndex = Math.min(...section.imageIndices);\n    \n    // Narration starts when its first image appears\n    // Special handling for 'closing' section - place at end of video\n    let sectionStart;\n    if (section.section === 'closing') {\n      // Closing should start near end, leaving room for narration\n      sectionStart = Math.max(videoDuration - clip.duration - 1, 0);\n      console.log(`Section ${i} (closing): Placing at end, start=${sectionStart}s`);\n    } else {\n      sectionStart = firstImageIndex * CLIP_DURATION;\n      console.log(`Section ${i} (${section.section}): First image=${firstImageIndex}, start=${sectionStart}s`);\n    }\n    \n    timeline.push({\n      type: 'audio',\n      src: clip.url,\n      start: parseFloat(Math.max(0, sectionStart).toFixed(3)),\n      loop: 0,\n      volume: 2\n    });\n  }\n  \n  // Sort by start time to avoid any overlap issues\n  timeline.sort((a, b) => a.start - b.start);\n  \n} else {\n  // CASE 2: Fallback - no section mapping, use sequential placement\n  console.log('Strategy: No section mapping - falling back to sequential');\n  \n  const introSilence = 2; // Short intro silence\n  let t = introSilence;\n  \n  audioClips.forEach((clip, idx) => {\n    console.log(`Audio ${idx}: start=${t}s, duration=${clip.duration}s`);\n    timeline.push({\n      type: 'audio',\n      src: clip.url,\n      start: parseFloat(t.toFixed(3)),\n      loop: 0,\n      volume: 2\n    });\n    t += clip.duration + 0.5; // Small gap between clips\n  });\n}\n\n// Log final timeline\nconsole.log('Final audio timeline:');\ntimeline.forEach((t, i) => {\n  console.log(`  [${i}] start: ${t.start}s`);\n});\n\n// ----------------------\n// JSON2Video payload\n// ----------------------\nconst payload = {\n  width: 1080,\n  height: 1920,\n  quality: 'high',\n  resolution: 'custom',\n  scenes: [\n    {\n      elements: [\n        {\n          type: 'video',\n          src: videoUrl,\n          volume: 0 // Mute merged clips (they have no audio anyway)\n        },\n        ...timeline\n      ]\n    }\n  ]\n};\n\nconsole.log('Payload prepared with', timeline.length, 'audio clips');\nconsole.log('First audio starts at:', timeline[0]?.start, 's');\nconsole.log('Last audio starts at:', timeline[timeline.length - 1]?.start, 's');\n\nreturn [{ json: payload }];"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          84464,
          29648
        ],
        "id": "cae2002a-6959-4678-92f2-f4c379fc3425",
        "name": "prepare body for jsontovideo to set video"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.json2video.com/v2/movies",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "contentType": "raw",
          "rawContentType": "scenes",
          "body": "={{ $json}}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          84688,
          29648
        ],
        "id": "066479f5-4324-4bc4-8321-e5853e007784",
        "name": "Call Jsontovideo to create task",
        "credentials": {
          "httpHeaderAuth": {
            "id": "ZmaCE8owCz8ioHlO",
            "name": "json2video"
          }
        }
      },
      {
        "parameters": {
          "url": "=https://api.json2video.com/v2/movies?id={{ $('Call Jsontovideo to create task').item.json.project }}",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.2,
        "position": [
          85136,
          29648
        ],
        "id": "afd367fd-42bb-452f-9ac9-31ce4d75af0c",
        "name": "Get video status",
        "credentials": {
          "httpHeaderAuth": {
            "id": "ZmaCE8owCz8ioHlO",
            "name": "json2video"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "loose"
            },
            "conditions": [
              {
                "id": "cond1-success-true",
                "leftValue": "={{ $json.movie.success }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "looseTypeValidation": true,
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          85360,
          29648
        ],
        "id": "3a550f1e-d2ed-47ee-a352-65644d88b380",
        "name": "If Task is Status is done go otherwise wait"
      },
      {
        "parameters": {
          "jsCode": "// Validate input from previous render step\nconst movieData = $input.first().json.movie;\nif (!movieData) {\n  throw new Error('PIPELINE ERROR: No movie data from previous render. Check \"Get video status\" output.');\n}\nif (!movieData.url) {\n  throw new Error('PIPELINE ERROR: movie.url is undefined. Previous render (\"Call Jsontovideo to create task\") may have failed. Status: ' + (movieData.status || 'unknown') + ', Error: ' + (movieData.message || 'none'));\n}\nif (!movieData.duration) {\n  throw new Error('PIPELINE ERROR: movie.duration is undefined.');\n}\n\nconst videoUrl = movieData.url;\nconst videoDuration = Number(movieData.duration);\nconst musicUrl = $('Webhook').first().json.body[0].music;\n\nconst audioDetails = $('Get duration of voices').all();\nconst audioStarting = $('prepare body for jsontovideo to set video').all();\n\n// Validate audio data\nif (!audioDetails || audioDetails.length === 0) {\n  throw new Error('PIPELINE ERROR: No audio details from \"Get duration of voices\"');\n}\nif (!audioStarting || audioStarting.length === 0 || !audioStarting[0].json.scenes) {\n  throw new Error('PIPELINE ERROR: No audio starting times from \"prepare body for jsontovideo to set video\"');\n}\n\n// durations from API\nconst durations = audioDetails.map(item => {\n  const dur = item.json.data?.duration;\n  if (dur === undefined) {\n    throw new Error('PIPELINE ERROR: Audio item missing duration');\n  }\n  return dur;\n});\n\n// extract start times from scenes\nconst starts = audioStarting[0].json.scenes[0].elements\n  .filter(el => el.type === 'audio')\n  .map(el => el.start);\n\nreturn [\n  {\n    json: {\n      videoUrl,\n      musicUrl,\n      durations,\n      starts,\n      videoDuration\n    }\n  }\n];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          85584,
          29648
        ],
        "id": "2b131b50-6524-4e9f-877c-732f1ba94016",
        "name": "get video metadata to add music"
      },
      {
        "parameters": {
          "method": "POST",
          "url": "https://api.json2video.com/v2/movies",
          "authentication": "genericCredentialType",
          "genericAuthType": "httpHeaderAuth",
          "sendBody": true,
          "contentType": "raw",
          "rawContentType": "scenes",
          "body": "={{ $json}}",
          "options": {}
        },
        "type": "n8n-nodes-base.httpRequest",
        "typeVersion": 4.3,
        "position": [
          86032,
          29648
        ],
        "id": "bb155957-fa48-4f53-a614-120cc5ebb80f",
        "name": "Call jsontovideo to render",
        "credentials": {
          "httpHeaderAuth": {
            "id": "ZmaCE8owCz8ioHlO",
            "name": "json2video"
          }
        }
      },
      {
        "parameters": {
          "conditions": {
            "options": {
              "version": 2,
              "leftValue": "",
              "caseSensitive": true,
              "typeValidation": "loose"
            },
            "conditions": [
              {
                "id": "cond1-success-true",
                "leftValue": "={{ $json.movie.success }}",
                "rightValue": true,
                "operator": {
                  "type": "boolean",
                  "operation": "equals"
                }
              }
            ],
            "combinator": "and"
          },
          "looseTypeValidation": true,
          "options": {}
        },
        "type": "n8n-nodes-base.if",
        "typeVersion": 2.2,
        "position": [
          86704,
          29648
        ],
        "id": "ce04738d-8506-4d61-b84d-173e4cf8c121",
        "name": "if task is done go otherwise wait"
      },
      {
        "parameters": {
          "jsCode": "// ============================================================\n// Prepare body for jsontovideo to render video\n// Adds ONLY music track with ducking - no text overlays\n// Video volume = 1 to preserve narration from previous render\n// ============================================================\n\nconst inputData = $input.first().json;\n\n// VALIDATION\nif (!inputData.videoUrl) {\n  throw new Error('VIDEO_URL_MISSING: videoUrl is undefined.');\n}\nif (!inputData.videoDuration || isNaN(inputData.videoDuration)) {\n  throw new Error('VIDEO_DURATION_MISSING: videoDuration is ' + inputData.videoDuration);\n}\nif (!inputData.musicUrl) {\n  throw new Error('MUSIC_URL_MISSING: musicUrl is undefined.');\n}\nif (!inputData.durations || !inputData.starts) {\n  throw new Error('AUDIO_DATA_MISSING: durations or starts array is undefined.');\n}\n\nconst videoUrl = inputData.videoUrl;\nconst musicUrl = inputData.musicUrl;\nconst durations = inputData.durations;\nconst starts = inputData.starts;\nconst videoDuration = Number(inputData.videoDuration);\n\n// Music volume settings\nconst MUSIC_HIGH = 0.8;\nconst MUSIC_LOW = 0.15;\nconst FADE_TIME = 0.5;\nconst MUSIC_TRACK_DURATION = 90;\n\nlet musicTimeline = [];\nlet currentTime = 0;\nlet musicOffset = 0;\n\n// Build music timeline with ducking during voice segments\nfor (let i = 0; i < starts.length; i++) {\n  const voiceStart = starts[i];\n  const voiceDuration = durations[i];\n  const voiceEnd = voiceStart + voiceDuration;\n\n  // High-volume music during gaps (before voice)\n  if (voiceStart > currentTime) {\n    const gapDuration = voiceStart - currentTime;\n    musicTimeline.push({\n      type: 'audio',\n      src: musicUrl,\n      start: currentTime,\n      seek: musicOffset % MUSIC_TRACK_DURATION,\n      duration: gapDuration,\n      volume: MUSIC_HIGH,\n      'fade-out': FADE_TIME\n    });\n    musicOffset += gapDuration;\n  }\n\n  // Low-volume music during voice (ducked)\n  musicTimeline.push({\n    type: 'audio',\n    src: musicUrl,\n    start: voiceStart,\n    seek: musicOffset % MUSIC_TRACK_DURATION,\n    duration: voiceDuration,\n    volume: MUSIC_LOW,\n    'fade-in': FADE_TIME,\n    'fade-out': FADE_TIME\n  });\n  musicOffset += voiceDuration;\n  currentTime = voiceEnd;\n}\n\n// Remaining music after last voice\nif (currentTime < videoDuration) {\n  const remainingDuration = videoDuration - currentTime;\n  musicTimeline.push({\n    type: 'audio',\n    src: musicUrl,\n    start: currentTime,\n    seek: musicOffset % MUSIC_TRACK_DURATION,\n    duration: remainingDuration,\n    volume: MUSIC_HIGH,\n    'fade-in': FADE_TIME,\n    'fade-out': 1.0\n  });\n}\n\n// Build final json2video payload\n// NOTE: video volume = 1 to PRESERVE NARRATION from previous render!\nconst payload = {\n  width: 1080,\n  height: 1920,\n  quality: 'high',\n  resolution: 'custom',\n  scenes: [\n    {\n      elements: [\n        {\n          type: 'video',\n          src: videoUrl,\n          volume: 1  // IMPORTANT: Keep narration audio!\n        },\n        ...musicTimeline\n      ]\n    }\n  ]\n};\n\nreturn [{ json: payload }];\n"
        },
        "type": "n8n-nodes-base.code",
        "typeVersion": 2,
        "position": [
          85808,
          29648
        ],
        "id": "3b77d61f-9dda-4d96-aeab-8f9bdf2eade1",
        "name": "Prepare body for jsontovideo to render video"
      },
      {
        "parameters": {
          "httpMethod": "POST",
          "path": "db085427-02a1-4f47-9934-9c258aa929b3",
          "options": {}
        },
        "type": "n8n-nodes-base.webhook",
        "typeVersion": 2.1,
        "position": [
          77152,
          29760
        ],
        "id": "161e7300-d90f-43fc-94dc-457cd14e976a",
        "name": "Webhook",
        "webhookId": "db085427-02a1-4f47-9934-9c258aa929b3"
      }
    ],
    "connections": {
      "Output final video": {
        "main": [
          [
            {
              "node": "ðŸŽ‰ Send video URL",
              "type": "main",
              "index": 0
            },
            {
              "node": "HTTP Request",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "json2video - Edit video1": {
        "main": [
          [
            {
              "node": "10 sec1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Check Errors ": {
        "main": [
          [
            {
              "node": "Output final video",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "10 sec1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Format variables for final editing1": {
        "main": [
          [
            {
              "node": "json2video - Edit video1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "10 sec1": {
        "main": [
          [
            {
              "node": "caption generation",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "10 sec3": {
        "main": [
          [
            {
              "node": "Get merged video Status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait 30 sec1": {
        "main": [
          [
            {
              "node": "Get image from kie",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "30 sec2": {
        "main": [
          [
            {
              "node": "Get video status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Separate image data": {
        "main": [
          [
            {
              "node": "Create task on kie to optimize images",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "caption generation": {
        "main": [
          [
            {
              "node": "Check Errors ",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Convert text to speech": {
        "main": [
          [
            {
              "node": "Upload Speech To S3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get final video status": {
        "main": [
          [
            {
              "node": "if task is done go otherwise wait",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "30 sec": {
        "main": [
          [
            {
              "node": "Get final video status",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Wait 30 sec3": {
        "main": [
          [
            {
              "node": "Get Kie Video Urls",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "30 sec3": {
        "main": [
          [
            {
              "node": "Get Video from Jsontovideo",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Make Optimized Images Array from Nano-banana": {
        "0": [
          [
            {
              "node": "Split the Script by double newline",
              "type": "0",
              "index": 0
            }
          ]
        ],
        "main": [
          [
            {
              "node": "Prepare Body for GPT To Analyze Images",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Standerdize Response": {
        "main": [
          [
            {
              "node": "If Status is Success Go Otherwise Wait",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get image from kie": {
        "main": [
          [
            {
              "node": "Standerdize Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Create task on kie to optimize images": {
        "main": [
          [
            {
              "node": "Wait 30 sec1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Status is Success Go Otherwise Wait": {
        "main": [
          [
            {
              "node": "Make Optimized Images Array from Nano-banana",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Wait 30 sec1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Body for GPT To Analyze Images": {
        "main": [
          [
            {
              "node": "Call Open AI To Analyze Images And Generate Script Accordingly",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Call Open AI To Analyze Images And Generate Script Accordingly": {
        "main": [
          [
            {
              "node": "Split the Script by double newline",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Split the Script by double newline": {
        "main": [
          [
            {
              "node": "Convert text to speech",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Upload Speech To S3": {
        "main": [
          [
            {
              "node": "Get duration of voices",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Call Kie Api Kling Model to Generate image to video": {
        "main": [
          [
            {
              "node": "Wait 30 sec3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare Body for Kie API (Kling model to generate video)": {
        "main": [
          [
            {
              "node": "Call Kie Api Kling Model to Generate image to video",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Kie Video Urls": {
        "main": [
          [
            {
              "node": "Standerdized Response",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Standerdized Response": {
        "main": [
          [
            {
              "node": "If Status is Success Go Otherwise Wait1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Status is Success Go Otherwise Wait1": {
        "main": [
          [
            {
              "node": "Seprate All Video Urls Generatad from Kei",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "Wait 30 sec3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get Video from Jsontovideo": {
        "main": [
          [
            {
              "node": "If status is done go otherwise wait",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Render Kie videos in json2video (full duration)": {
        "main": [
          [
            {
              "node": "30 sec3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If status is done go otherwise wait": {
        "main": [
          [
            {
              "node": "Make body for jsontovideo Api to merge videos clips",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "30 sec3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Make body for jsontovideo Api to merge videos clips": {
        "main": [
          [
            {
              "node": "Call Jsontovideo API to merge clips",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Call Jsontovideo API to merge clips": {
        "main": [
          [
            {
              "node": "10 sec3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get merged video Status": {
        "main": [
          [
            {
              "node": "If status is done go otherwise wait1",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If status is done go otherwise wait1": {
        "main": [
          [
            {
              "node": "prepare body for jsontovideo to set video",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "10 sec3",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "prepare body for jsontovideo to set video": {
        "main": [
          [
            {
              "node": "Call Jsontovideo to create task",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Call Jsontovideo to create task": {
        "main": [
          [
            {
              "node": "30 sec2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get video status": {
        "main": [
          [
            {
              "node": "If Task is Status is done go otherwise wait",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "If Task is Status is done go otherwise wait": {
        "main": [
          [
            {
              "node": "get video metadata to add music",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "30 sec2",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "get video metadata to add music": {
        "main": [
          [
            {
              "node": "Prepare body for jsontovideo to render video",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Call jsontovideo to render": {
        "main": [
          [
            {
              "node": "30 sec",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "if task is done go otherwise wait": {
        "main": [
          [
            {
              "node": "Format variables for final editing1",
              "type": "main",
              "index": 0
            }
          ],
          [
            {
              "node": "30 sec",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Prepare body for jsontovideo to render video": {
        "main": [
          [
            {
              "node": "Call jsontovideo to render",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Webhook": {
        "main": [
          [
            {
              "node": "Separate image data",
              "type": "main",
              "index": 0
            },
            {
              "node": "save execution id to db",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Get duration of voices": {
        "main": [
          [
            {
              "node": "Prepare Body for Kie API (Kling model to generate video)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      },
      "Seprate All Video Urls Generatad from Kei": {
        "main": [
          [
            {
              "node": "Render Kie videos in json2video (full duration)",
              "type": "main",
              "index": 0
            }
          ]
        ]
      }
    },
    "authors": "Shawheen Nabizadeh",
    "name": null,
    "description": null,
    "autosaved": false,
    "workflowPublishHistory": [
      {
        "createdAt": "2026-01-16T07:34:01.621Z",
        "id": 741,
        "workflowId": "Qo2sirL0cDI2fVNQMJ5Eq",
        "versionId": "1fddadf9-828e-4da4-951f-bf3119ff4e63",
        "event": "activated",
        "userId": "92d3fbdb-a49c-432b-b35c-b3d875346f08"
      }
    ]
  }
}