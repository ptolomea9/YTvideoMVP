---
phase: 04-dashboard
plan: 03
type: execute
---

<objective>
Display realtime progress states for videos being generated, showing current step and visual progress indicator.

Purpose: Keep agents informed about their video generation progress with live status updates.
Output: VideoCard shows animated progress indicator with current step label for in-progress videos.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Dependencies
@.planning/phases/04-dashboard/04-01-PLAN.md
@.planning/phases/04-dashboard/04-02-PLAN.md

# Existing codebase
@src/components/dashboard/VideoCard.tsx
@src/hooks/useVideoStatusSubscription.ts
@src/components/providers/VideoStatusProvider.tsx
@src/types/video.ts

**Tech stack available:**
- Supabase Realtime (already enabled for videos table)
- useVideoStatusSubscription hook (shows toasts on completion)
- Framer Motion for animations
- Tailwind CSS

**Video status progression:**
1. pending → 2. processing → 3. sorting_images → 4. generating_motion → 5. generating_audio → 6. rendering → 7. completed/failed

**Existing realtime:**
- useVideoStatusSubscription shows toasts when status changes to completed/failed
- Need to extend this to update card UI in realtime
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create VideoProgressOverlay component</name>
  <files>src/components/dashboard/VideoProgressOverlay.tsx</files>
  <action>
Create an overlay component that shows progress for in-progress videos:

1. Props: status (VideoStatus)

2. Progress step mapping:
   ```typescript
   const PROGRESS_STEPS = {
     pending: { step: 0, label: 'Queued', percent: 0 },
     processing: { step: 1, label: 'Starting...', percent: 10 },
     sorting_images: { step: 2, label: 'Sorting images', percent: 25 },
     generating_motion: { step: 3, label: 'Creating motion', percent: 45 },
     generating_audio: { step: 4, label: 'Generating narration', percent: 65 },
     rendering: { step: 5, label: 'Rendering video', percent: 85 },
     completed: { step: 6, label: 'Complete', percent: 100 },
     failed: { step: -1, label: 'Failed', percent: 0 },
   };
   ```

3. Visual design:
   - Semi-transparent dark overlay on card (bg-black/70)
   - Centered content: animated spinner + step label
   - Progress bar at bottom of overlay showing percent
   - Use Framer Motion for smooth transitions between states

4. Spinner: Use a custom luxury spinner (gold ring with animation) or Lucide Loader2 with gold color

5. Only render if status is one of: pending, processing, sorting_images, generating_motion, generating_audio, rendering
  </action>
  <verify>Component renders with correct label and progress bar for each status</verify>
  <done>VideoProgressOverlay shows animated spinner, step label, and progress bar for in-progress statuses</done>
</task>

<task type="auto">
  <name>Task 2: Integrate progress overlay into VideoCard</name>
  <files>src/components/dashboard/VideoCard.tsx</files>
  <action>
Add VideoProgressOverlay to VideoCard for in-progress videos:

1. Import VideoProgressOverlay component

2. Conditionally render overlay:
   - Show overlay when status is pending, processing, sorting_images, generating_motion, generating_audio, or rendering
   - Hide overlay when status is completed or failed

3. For failed status:
   - Show different overlay with error icon and "Generation failed" message
   - Include error_message if available (truncated)

4. Overlay positioning:
   - Absolute positioned over the thumbnail
   - Full card coverage (inset-0)
   - Higher z-index than thumbnail

5. Disable hover effects for in-progress/failed videos (no video to play)
  </action>
  <verify>In-progress videos show progress overlay, failed videos show error overlay</verify>
  <done>VideoCard renders appropriate overlay for in-progress and failed videos</done>
</task>

<task type="auto">
  <name>Task 3: Add realtime refresh to dashboard</name>
  <files>src/app/(protected)/dashboard/page.tsx, src/components/dashboard/VideoGallery.tsx</files>
  <action>
Split dashboard into server/client parts for realtime updates:

1. Create VideoGallery client component (src/components/dashboard/VideoGallery.tsx):
   - Receives initialVideos from server component
   - Uses useState to hold current videos
   - Subscribes to Supabase Realtime for video updates
   - Updates local state when video status changes (INSERT, UPDATE events)

2. Subscription filter:
   - Subscribe to videos table changes for current user_id
   - On UPDATE: Find and replace video in state
   - On INSERT: Add new video to beginning of array

3. Dashboard page becomes simpler:
   - Fetch initial videos (server component)
   - Pass to VideoGallery client component
   - VideoGallery handles realtime updates

4. Ensure VideoGallery re-fetches listing data when needed:
   - For new videos from realtime, fetch listing address via API or include in subscription payload
   - Simpler: Just refetch when we get INSERT events (router.refresh())

Note: The existing useVideoStatusSubscription handles toasts. This subscription handles UI updates.
  </action>
  <verify>Create a video via /create → dashboard updates in realtime showing progress → completes → card shows video</verify>
  <done>Dashboard updates in realtime when video status changes, no manual refresh needed</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] In-progress videos show animated progress overlay
- [ ] Progress label updates as status changes (via realtime)
- [ ] Failed videos show error overlay with message
- [ ] New videos appear in dashboard without refresh
- [ ] Status changes animate smoothly
</verification>

<success_criteria>
- VideoProgressOverlay displays correct step for each status
- VideoCard shows overlay for in-progress/failed, hides for completed
- Realtime subscription updates dashboard UI when status changes
- Smooth animations between states
</success_criteria>

<output>
After completion, create `.planning/phases/04-dashboard/04-03-SUMMARY.md` following summary template.
</output>
