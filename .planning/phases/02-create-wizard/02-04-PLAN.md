---
phase: 02-create-wizard
plan: 04
type: execute
---

<objective>
Build Step 3: Script HITL editor with 5 AI-generated sections that users can edit.

Purpose: Generate engaging narration script and allow agents to refine their property's story.
Output: Script generation via GPT-4 and editable text areas for each section (MVP-critical feature).
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./02-04-SUMMARY.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior plan context:
@.planning/phases/02-create-wizard/02-01-SUMMARY.md
@.planning/phases/02-create-wizard/02-02-SUMMARY.md
@.planning/phases/02-create-wizard/02-03-SUMMARY.md

# Wizard types and OpenAI:
@src/lib/wizard/types.ts
@src/lib/openai.ts

**MVP-Critical:** This is the HITL (Human-in-the-Loop) feature that differentiates the product.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create script generation API</name>
  <files>src/app/api/script/generate/route.ts</files>
  <action>
Create POST /api/script/generate endpoint:

Input: property data (address, specs, description) + neighborhood POIs + image categories
Output: 5 script sections as JSON array

Sections (each ~30-45 words for ~15s of narration):
1. Opening Hook - Attention grabber about the property
2. Property Overview - Key features and specs
3. Interior Highlights - Living spaces, bedrooms, bathrooms
4. Outdoor & Neighborhood - Yard, nearby POIs
5. Closing CTA - Call to action with agent contact

GPT-4 prompt should:
- Write in professional real estate voice
- Mention specific features from input
- Reference neighborhood POIs naturally
- Keep each section concise for voiceover
- Use luxury/aspirational language matching brand

Return: { sections: [{ id, title, content, wordCount }] }
  </action>
  <verify>API returns 5 sections with appropriate content</verify>
  <done>Script generation produces 5 editable sections</done>
</task>

<task type="auto">
  <name>Task 2: Create script editor component</name>
  <files>src/components/wizard/steps/script-step.tsx, src/components/ui/textarea.tsx</files>
  <action>
Create ScriptStep component with HITL editing:

Layout:
- "Generate Script" button (if no script yet)
- Loading state with writing animation
- 5 collapsible sections, each with:
  - Section title header (Opening Hook, Property Overview, etc.)
  - Editable textarea with script content
  - Word count indicator (target: 30-45 words)
  - Character count for ElevenLabs budget
  - "Regenerate Section" button (refresh icon)

Add shadcn Textarea (npx shadcn@latest add textarea).

Editing UX:
- Auto-save to wizard context on change (debounced 500ms)
- Visual indicator when section modified from original
- Word count changes color if too long (>60 words)

Store in wizard state as: { id, title, content, originalContent, modified }[]
  </action>
  <verify>npm run build succeeds, editor renders with textareas</verify>
  <done>Script editor shows 5 editable sections with word counts</done>
</task>

<task type="auto">
  <name>Task 3: Wire script step to wizard flow</name>
  <files>src/app/(protected)/create/page.tsx</files>
  <action>
Integrate ScriptStep into wizard:

- Render ScriptStep when currentStep === WizardStep.SCRIPT
- On mount: auto-generate script if none exists
- Script persists in wizard context across step changes
- Next button enabled when all 5 sections have content

"Regenerate All" button at bottom to start fresh.
Individual section regeneration calls API with just that section ID.

Progress indicator: "X of 5 sections edited"
  </action>
  <verify>Step 3 loads, generates script, allows editing</verify>
  <done>Script step integrated with generation and editing</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>AI script generation with 5 editable HITL sections</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Complete Steps 1-2 (property data, image upload)
    3. Advance to Step 3:
       - Verify script auto-generates on load (or click Generate)
       - Verify 5 sections appear with titles and content
       - Edit one section - verify word count updates
       - Verify changes persist after navigating away and back
       - Click "Regenerate Section" on one section
       - Verify edited sections show "modified" indicator
    4. Confirm: Script content is relevant to entered property data
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds
- [ ] Script generation produces 5 relevant sections
- [ ] All sections are editable with word counts
- [ ] Changes persist in wizard state
- [ ] Human verified HITL experience
</verification>

<success_criteria>

- All 4 tasks completed (including checkpoint)
- All verification checks pass
- Script quality is appropriate for real estate
- Editing UX feels polished and professional
</success_criteria>

<output>
After completion, create `.planning/phases/02-create-wizard/02-04-SUMMARY.md`
</output>
